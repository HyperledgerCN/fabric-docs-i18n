

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building Your First Network &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Writing Your First Application" href="write_first_app.html" />
    <link rel="prev" title="Tutorials" href="tutorials.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
<br>
<a href="https://chat.hyperledger.org">Rocket Chat</a>  <a href="https://jenkins.hyperledger.org/">CI</a>
<a href="http://stackoverflow.com/questions/tagged/hyperledger-fabric">StackOverflow</a>
<br>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Welcome to Hyperledger Fabric</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="key_concepts.html">Key Concepts</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Building Your First Network</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-prerequisites">Install prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#want-to-run-it-now">Want to run it now?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#crypto-generator">Crypto Generator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-transaction-generator">Configuration Transaction Generator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-tools">Run the tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-the-network">Start the network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#understanding-the-docker-compose-topology">Understanding the Docker Compose topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-couchdb">Using CouchDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-couchdb">Why CouchDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-note-on-data-persistence">A Note on Data Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="write_first_app.html">Writing Your First Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="channel_update_tutorial.html">Adding an Org to a Channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrading_your_network_tutorial.html">Upgrading Your Network Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="chaincode.html">Chaincode Tutorials</a></li>
<li class="toctree-l3"><a class="reference internal" href="chaincode4ade.html">Chaincode for Developers</a></li>
<li class="toctree-l3"><a class="reference internal" href="chaincode4noah.html">Chaincode for Operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="systemchaincode.html">System Chaincode Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="videos.html">Videos</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ops_guide.html">Operations Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_ref.html">Commands Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Architecture Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fabric-FAQ.html">Hyperledger Fabric FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="ordering-service-faq.html">Ordering Service FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="questions.html">Still Have Questions?</a></li>
<li class="toctree-l2"><a class="reference internal" href="status.html">Status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building Your First Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-prerequisites">Install prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#want-to-run-it-now">Want to run it now?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generate-network-artifacts">Generate Network Artifacts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bring-up-the-network">Bring Up the Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bring-down-the-network">Bring Down the Network</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#crypto-generator">Crypto Generator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-does-it-work">How does it work?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-transaction-generator">Configuration Transaction Generator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">How does it work?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-tools">Run the tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#manually-generate-the-artifacts">Manually generate the artifacts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-channel-configuration-transaction">Create a Channel Configuration Transaction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#start-the-network">Start the network</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-join-channel">Create &amp; Join Channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-the-anchor-peers">Update the anchor peers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-instantiate-chaincode">Install &amp; Instantiate Chaincode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query">Query</a></li>
<li class="toctree-l4"><a class="reference internal" href="#invoke">Invoke</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Query</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-s-happening-behind-the-scenes">What’s happening behind the scenes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-does-this-demonstrate">What does this demonstrate?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-do-i-see-these-transactions">How do I see these transactions?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-can-i-see-the-chaincode-logs">How can I see the chaincode logs?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-docker-compose-topology">Understanding the Docker Compose topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-couchdb">Using CouchDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#why-couchdb">Why CouchDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-note-on-data-persistence">A Note on Data Persistence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="write_first_app.html">Writing Your First Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel_update_tutorial.html">Adding an Org to a Channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading_your_network_tutorial.html">Upgrading Your Network Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="chaincode.html">Chaincode Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="chaincode4ade.html">Chaincode for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="chaincode4noah.html">Chaincode for Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="systemchaincode.html">System Chaincode Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="videos.html">Videos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fabric-FAQ.html">Hyperledger Fabric FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="ordering-service-faq.html">Ordering Service FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Building Your First Network</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/build_network.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-your-first-network">
<h1>Building Your First Network<a class="headerlink" href="#building-your-first-network" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These instructions have been verified to work against the
latest stable Docker images and the pre-compiled
setup utilities within the supplied tar file. If you run
these commands with images or tools from the current master
branch, it is possible that you will see configuration and panic
errors.</p>
</div>
<p>The build your first network (BYFN) scenario provisions a sample Hyperledger
Fabric network consisting of two organizations, each maintaining two peer
nodes, and a “solo” ordering service.</p>
<div class="section" id="install-prerequisites">
<h2>Install prerequisites<a class="headerlink" href="#install-prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before we begin, if you haven’t already done so, you may wish to check that
you have all the <a class="reference internal" href="prereqs.html"><span class="doc">Prerequisites</span></a> installed on the platform(s)
on which you’ll be developing blockchain applications and/or operating
Hyperledger Fabric.</p>
<p>You will also need to download and install the <a class="reference internal" href="samples.html"><span class="doc">Hyperledger Fabric Samples</span></a>. You will notice
that there are a number of samples included in the <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code>
repository. We will be using the <code class="docutils literal notranslate"><span class="pre">first-network</span></code> sample. Let’s open that
sub-directory now.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">fabric</span><span class="o">-</span><span class="n">samples</span><span class="o">/</span><span class="n">first</span><span class="o">-</span><span class="n">network</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The supplied commands in this documentation
<strong>MUST</strong> be run from your <code class="docutils literal notranslate"><span class="pre">first-network</span></code> sub-directory
of the <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> repository clone.  If you elect to run the
commands from a different location, the various provided scripts
will be unable to find the binaries.</p>
</div>
</div>
<div class="section" id="want-to-run-it-now">
<h2>Want to run it now?<a class="headerlink" href="#want-to-run-it-now" title="Permalink to this headline">¶</a></h2>
<p>We provide a fully annotated script - <code class="docutils literal notranslate"><span class="pre">byfn.sh</span></code> - that leverages these Docker
images to quickly bootstrap a Hyperledger Fabric network comprised of 4 peers
representing two different organizations, and an orderer node. It will also
launch a container to run a scripted execution that will join peers to a
channel, deploy and instantiate chaincode and drive execution of transactions
against the deployed chaincode.</p>
<p>Here’s the help text for the <code class="docutils literal notranslate"><span class="pre">byfn.sh</span></code> script:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">help</span>
<span class="n">Usage</span><span class="p">:</span>
<span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="n">up</span><span class="o">|</span><span class="n">down</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">generate</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">channel</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">timeout</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">delay</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">dbtype</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">h</span><span class="o">|--</span><span class="n">help</span> <span class="p">(</span><span class="nb">print</span> <span class="n">this</span> <span class="n">message</span><span class="p">)</span>
  <span class="o">-</span><span class="n">m</span> <span class="o">&lt;</span><span class="n">mode</span><span class="o">&gt;</span> <span class="o">-</span> <span class="n">one</span> <span class="n">of</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="s1">&#39;restart&#39;</span> <span class="ow">or</span> <span class="s1">&#39;generate&#39;</span>
    <span class="o">-</span> <span class="s1">&#39;up&#39;</span> <span class="o">-</span> <span class="n">bring</span> <span class="n">up</span> <span class="n">the</span> <span class="n">network</span> <span class="k">with</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span>
    <span class="o">-</span> <span class="s1">&#39;down&#39;</span> <span class="o">-</span> <span class="n">clear</span> <span class="n">the</span> <span class="n">network</span> <span class="k">with</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">down</span>
    <span class="o">-</span> <span class="s1">&#39;restart&#39;</span> <span class="o">-</span> <span class="n">restart</span> <span class="n">the</span> <span class="n">network</span>
    <span class="o">-</span> <span class="s1">&#39;generate&#39;</span> <span class="o">-</span> <span class="n">generate</span> <span class="n">required</span> <span class="n">certificates</span> <span class="ow">and</span> <span class="n">genesis</span> <span class="n">block</span>
  <span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">channel</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span> <span class="n">channel</span> <span class="n">name</span> <span class="n">to</span> <span class="n">use</span> <span class="p">(</span><span class="n">defaults</span> <span class="n">to</span> <span class="s2">&quot;mychannel&quot;</span><span class="p">)</span>
  <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">timeout</span><span class="o">&gt;</span> <span class="o">-</span> <span class="n">CLI</span> <span class="n">timeout</span> <span class="n">duration</span> <span class="ow">in</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">defaults</span> <span class="n">to</span> <span class="mi">10</span><span class="p">)</span>
  <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">delay</span><span class="o">&gt;</span> <span class="o">-</span> <span class="n">delay</span> <span class="n">duration</span> <span class="ow">in</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">defaults</span> <span class="n">to</span> <span class="mi">3</span><span class="p">)</span>
  <span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="o">-</span> <span class="n">specify</span> <span class="n">which</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">file</span> <span class="n">use</span> <span class="p">(</span><span class="n">defaults</span> <span class="n">to</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">cli</span><span class="o">.</span><span class="n">yaml</span><span class="p">)</span>
  <span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">dbtype</span><span class="o">&gt;</span> <span class="o">-</span> <span class="n">the</span> <span class="n">database</span> <span class="n">backend</span> <span class="n">to</span> <span class="n">use</span><span class="p">:</span> <span class="n">goleveldb</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="ow">or</span> <span class="n">couchdb</span>
  <span class="o">-</span><span class="n">l</span> <span class="o">&lt;</span><span class="n">language</span><span class="o">&gt;</span> <span class="o">-</span> <span class="n">the</span> <span class="n">chaincode</span> <span class="n">language</span><span class="p">:</span> <span class="n">golang</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span>
  <span class="o">-</span><span class="n">a</span> <span class="o">-</span> <span class="n">don</span><span class="s1">&#39;t ask for confirmation before proceeding</span>

  <span class="n">Typically</span><span class="p">,</span> <span class="n">one</span> <span class="n">would</span> <span class="n">first</span> <span class="n">generate</span> <span class="n">the</span> <span class="n">required</span> <span class="n">certificates</span> <span class="ow">and</span>
  <span class="n">genesis</span> <span class="n">block</span><span class="p">,</span> <span class="n">then</span> <span class="n">bring</span> <span class="n">up</span> <span class="n">the</span> <span class="n">network</span><span class="o">.</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">:</span>

      <span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">m</span> <span class="n">generate</span> <span class="o">-</span><span class="n">c</span> <span class="n">mychannel</span>
      <span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">m</span> <span class="n">up</span> <span class="o">-</span><span class="n">c</span> <span class="n">mychannel</span> <span class="o">-</span><span class="n">s</span> <span class="n">couchdb</span>
</pre></div>
</div>
<p>If you choose not to supply a channel name, then the
script will use a default name of <code class="docutils literal notranslate"><span class="pre">mychannel</span></code>.  The CLI timeout parameter
(specified with the -t flag) is an optional value; if you choose not to set
it, then the CLI will give up on query requests made after the default
setting of 10 seconds.</p>
<div class="section" id="generate-network-artifacts">
<h3>Generate Network Artifacts<a class="headerlink" href="#generate-network-artifacts" title="Permalink to this headline">¶</a></h3>
<p>Ready to give it a go? Okay then! Execute the following command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">m</span> <span class="n">generate</span>
</pre></div>
</div>
<p>You will see a brief description as to what will occur, along with a yes/no command line
prompt. Respond with a <code class="docutils literal notranslate"><span class="pre">y</span></code> or hit the return key to execute the described action.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>Generating certs and genesis block for with channel &#39;mychannel&#39; and CLI timeout of &#39;10&#39;
Continue? [Y/n] y
proceeding ...
/Users/xxx/dev/fabric-samples/bin/cryptogen

##########################################################
##### Generate certificates using cryptogen tool #########
##########################################################
org1.example.com
2017-06-12 21:01:37.334 EDT [bccsp] GetDefault -&gt; WARN 001 Before using BCCSP, please call InitFactories(). Falling back to bootBCCSP.
...

/Users/xxx/dev/fabric-samples/bin/configtxgen
##########################################################
#########  Generating Orderer Genesis block ##############
##########################################################
2017-06-12 21:01:37.558 EDT [common/configtx/tool] main -&gt; INFO 001 Loading configuration
2017-06-12 21:01:37.562 EDT [msp] getMspConfig -&gt; INFO 002 intermediate certs folder not found at [/Users/xxx/dev/byfn/crypto-config/ordererOrganizations/example.com/msp/intermediatecerts]. Skipping.: [stat /Users/xxx/dev/byfn/crypto-config/ordererOrganizations/example.com/msp/intermediatecerts: no such file or directory]
...
2017-06-12 21:01:37.588 EDT [common/configtx/tool] doOutputBlock -&gt; INFO 00b Generating genesis block
2017-06-12 21:01:37.590 EDT [common/configtx/tool] doOutputBlock -&gt; INFO 00c Writing genesis block

#################################################################
### Generating channel configuration transaction &#39;channel.tx&#39; ###
#################################################################
2017-06-12 21:01:37.634 EDT [common/configtx/tool] main -&gt; INFO 001 Loading configuration
2017-06-12 21:01:37.644 EDT [common/configtx/tool] doOutputChannelCreateTx -&gt; INFO 002 Generating new channel configtx
2017-06-12 21:01:37.645 EDT [common/configtx/tool] doOutputChannelCreateTx -&gt; INFO 003 Writing new channel tx

#################################################################
#######    Generating anchor peer update for Org1MSP   ##########
#################################################################
2017-06-12 21:01:37.674 EDT [common/configtx/tool] main -&gt; INFO 001 Loading configuration
2017-06-12 21:01:37.678 EDT [common/configtx/tool] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update
2017-06-12 21:01:37.679 EDT [common/configtx/tool] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update

#################################################################
#######    Generating anchor peer update for Org2MSP   ##########
#################################################################
2017-06-12 21:01:37.700 EDT [common/configtx/tool] main -&gt; INFO 001 Loading configuration
2017-06-12 21:01:37.704 EDT [common/configtx/tool] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update
2017-06-12 21:01:37.704 EDT [common/configtx/tool] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update
</pre></div>
</div>
<p>This first step generates all of the certificates and keys for our various
network entities, the <code class="docutils literal notranslate"><span class="pre">genesis</span> <span class="pre">block</span></code> used to bootstrap the ordering service,
and a collection of configuration transactions required to configure a
<a class="reference internal" href="glossary.html#channel"><span class="std std-ref">Channel</span></a>.</p>
</div>
<div class="section" id="bring-up-the-network">
<h3>Bring Up the Network<a class="headerlink" href="#bring-up-the-network" title="Permalink to this headline">¶</a></h3>
<p>Next, you can bring the network up with one of the following commands:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">m</span> <span class="n">up</span>
</pre></div>
</div>
<p>The above command will compile Golang chaincode images and spin up the corresponding
containers.  Go is the default chaincode language, however there is also support
for <a class="reference external" href="https://fabric-shim.github.io/">Node.js</a> chaincode.  If you’d like to run through this tutorial with node
chaincode, pass the following command instead:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># we use the -l flag to specify the chaincode language</span>
<span class="c1"># forgoing the -l flag will default to Golang</span>

<span class="o">./</span><span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">m</span> <span class="n">up</span> <span class="o">-</span><span class="n">l</span> <span class="n">node</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">View the <a class="reference external" href="https://fabric-shim.github.io/ChaincodeStub.html">Hyperledger Fabric Shim</a>
documentation for more info on the node.js chaincode shim APIs.</p>
</div>
<p>Once again, you will be prompted as to whether you wish to continue or abort.
Respond with a <code class="docutils literal notranslate"><span class="pre">y</span></code> or hit the return key:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>Starting with channel &#39;mychannel&#39; and CLI timeout of &#39;10&#39;
Continue? [Y/n]
proceeding ...
Creating network &quot;net_byfn&quot; with the default driver
Creating peer0.org1.example.com
Creating peer1.org1.example.com
Creating peer0.org2.example.com
Creating orderer.example.com
Creating peer1.org2.example.com
Creating cli


 ____    _____      _      ____    _____
/ ___|  |_   _|    / \    |  _ \  |_   _|
\___ \    | |     / _ \   | |_) |   | |
 ___) |   | |    / ___ \  |  _ &lt;    | |
|____/    |_|   /_/   \_\ |_| \_\   |_|

Channel name : mychannel
Creating channel...
</pre></div>
</div>
<p>The logs will continue from there. This will launch all of the containers, and
then drive a complete end-to-end application scenario. Upon successful
completion, it should report the following in your terminal window:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Query</span> <span class="n">Result</span><span class="p">:</span> <span class="mi">90</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span> <span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">15.158</span> <span class="n">UTC</span> <span class="p">[</span><span class="n">main</span><span class="p">]</span> <span class="n">main</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">008</span> <span class="n">Exiting</span><span class="o">.....</span>
<span class="o">=====================</span> <span class="n">Query</span> <span class="n">on</span> <span class="n">peer1</span><span class="o">.</span><span class="n">org2</span> <span class="n">on</span> <span class="n">channel</span> <span class="s1">&#39;mychannel&#39;</span> <span class="ow">is</span> <span class="n">successful</span> <span class="o">=====================</span>

<span class="o">=====================</span> <span class="n">All</span> <span class="n">GOOD</span><span class="p">,</span> <span class="n">BYFN</span> <span class="n">execution</span> <span class="n">completed</span> <span class="o">=====================</span>


 <span class="n">_____</span>   <span class="n">_</span>   <span class="n">_</span>   <span class="n">____</span>
<span class="o">|</span> <span class="n">____</span><span class="o">|</span> <span class="o">|</span> \ <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">_</span> \
<span class="o">|</span>  <span class="n">_</span><span class="o">|</span>   <span class="o">|</span>  \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">|</span><span class="n">___</span>  <span class="o">|</span> <span class="o">|</span>\  <span class="o">|</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
<span class="o">|</span><span class="n">_____</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> \<span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">____</span><span class="o">/</span>
</pre></div>
</div>
<p>You can scroll through these logs to see the various transactions. If you don’t
get this result, then jump down to the <a class="reference internal" href="#troubleshoot"><span class="std std-ref">Troubleshooting</span></a> section and let’s see
whether we can help you discover what went wrong.</p>
</div>
<div class="section" id="bring-down-the-network">
<h3>Bring Down the Network<a class="headerlink" href="#bring-down-the-network" title="Permalink to this headline">¶</a></h3>
<p>Finally, let’s bring it all down so we can explore the network setup one step
at a time. The following will kill your containers, remove the crypto material
and four artifacts, and delete the chaincode images from your Docker Registry:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">m</span> <span class="n">down</span>
</pre></div>
</div>
<p>Once again, you will be prompted to continue, respond with a <code class="docutils literal notranslate"><span class="pre">y</span></code> or hit the return key:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>Stopping with channel &#39;mychannel&#39; and CLI timeout of &#39;10&#39;
Continue? [Y/n] y
proceeding ...
WARNING: The CHANNEL_NAME variable is not set. Defaulting to a blank string.
WARNING: The TIMEOUT variable is not set. Defaulting to a blank string.
Removing network net_byfn
468aaa6201ed
...
Untagged: dev-peer1.org2.example.com-mycc-1.0:latest
Deleted: sha256:ed3230614e64e1c83e510c0c282e982d2b06d148b1c498bbdcc429e2b2531e91
...
</pre></div>
</div>
<p>If you’d like to learn more about the underlying tooling and bootstrap mechanics,
continue reading.  In these next sections we’ll walk through the various steps
and requirements to build a fully-functional Hyperledger Fabric network.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The manual steps outlined below assume that the <code class="docutils literal notranslate"><span class="pre">CORE_LOGGING_LEVEL</span></code> in
the <code class="docutils literal notranslate"><span class="pre">cli</span></code> container is set to <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>. You can set this by modifying
the <code class="docutils literal notranslate"><span class="pre">docker-compose-cli.yaml</span></code> file in the <code class="docutils literal notranslate"><span class="pre">first-network</span></code> directory.
e.g.</p>
<div class="code last highlight-default notranslate"><div class="highlight"><pre><span></span>cli:
  container_name: cli
  image: hyperledger/fabric-tools:$IMAGE_TAG
  tty: true
  stdin_open: true
  environment:
    - GOPATH=/opt/gopath
    - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
    - CORE_LOGGING_LEVEL=DEBUG
    #- CORE_LOGGING_LEVEL=INFO
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="crypto-generator">
<h2>Crypto Generator<a class="headerlink" href="#crypto-generator" title="Permalink to this headline">¶</a></h2>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">cryptogen</span></code> tool to generate the cryptographic material
(x509 certs and signing keys) for our various network entities.  These certificates are
representative of identities, and they allow for sign/verify authentication to
take place as our entities communicate and transact.</p>
<div class="section" id="how-does-it-work">
<h3>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h3>
<p>Cryptogen consumes a file - <code class="docutils literal notranslate"><span class="pre">crypto-config.yaml</span></code> - that contains the network
topology and allows us to generate a set of certificates and keys for both the
Organizations and the components that belong to those Organizations.  Each
Organization is provisioned a unique root certificate (<code class="docutils literal notranslate"><span class="pre">ca-cert</span></code>) that binds
specific components (peers and orderers) to that Org.  By assigning each
Organization a unique CA certificate, we are mimicking a typical network where
a participating <a class="reference internal" href="glossary.html#member"><span class="std std-ref">Member</span></a> would use its own Certificate Authority.
Transactions and communications within Hyperledger Fabric are signed by an
entity’s private key (<code class="docutils literal notranslate"><span class="pre">keystore</span></code>), and then verified by means of a public
key (<code class="docutils literal notranslate"><span class="pre">signcerts</span></code>).</p>
<p>You will notice a <code class="docutils literal notranslate"><span class="pre">count</span></code> variable within this file.  We use this to specify
the number of peers per Organization; in our case there are two peers per Org.
We won’t delve into the minutiae of <a class="reference external" href="https://en.wikipedia.org/wiki/Public_key_infrastructure">x.509 certificates and public key
infrastructure</a>
right now. If you’re interested, you can peruse these topics on your own time.</p>
<p>Before running the tool, let’s take a quick look at a snippet from the
<code class="docutils literal notranslate"><span class="pre">crypto-config.yaml</span></code>. Pay specific attention to the “Name”, “Domain”
and “Specs” parameters under the <code class="docutils literal notranslate"><span class="pre">OrdererOrgs</span></code> header:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OrdererOrgs</span><span class="p">:</span>
<span class="c1">#---------------------------------------------------------</span>
<span class="c1"># Orderer</span>
<span class="c1"># --------------------------------------------------------</span>
<span class="o">-</span> <span class="n">Name</span><span class="p">:</span> <span class="n">Orderer</span>
  <span class="n">Domain</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
  <span class="n">CA</span><span class="p">:</span>
      <span class="n">Country</span><span class="p">:</span> <span class="n">US</span>
      <span class="n">Province</span><span class="p">:</span> <span class="n">California</span>
      <span class="n">Locality</span><span class="p">:</span> <span class="n">San</span> <span class="n">Francisco</span>
  <span class="c1">#   OrganizationalUnit: Hyperledger Fabric</span>
  <span class="c1">#   StreetAddress: address for org # default nil</span>
  <span class="c1">#   PostalCode: postalCode for org # default nil</span>
  <span class="c1"># ------------------------------------------------------</span>
  <span class="c1"># &quot;Specs&quot; - See PeerOrgs below for complete description</span>
<span class="c1"># -----------------------------------------------------</span>
  <span class="n">Specs</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Hostname</span><span class="p">:</span> <span class="n">orderer</span>
<span class="c1"># -------------------------------------------------------</span>
<span class="c1"># &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes</span>
 <span class="c1"># ------------------------------------------------------</span>
<span class="n">PeerOrgs</span><span class="p">:</span>
<span class="c1"># -----------------------------------------------------</span>
<span class="c1"># Org1</span>
<span class="c1"># ----------------------------------------------------</span>
<span class="o">-</span> <span class="n">Name</span><span class="p">:</span> <span class="n">Org1</span>
  <span class="n">Domain</span><span class="p">:</span> <span class="n">org1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
  <span class="n">EnableNodeOUs</span><span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
<p>The naming convention for a network entity is as follows -
“{{.Hostname}}.{{.Domain}}”.  So using our ordering node as a
reference point, we are left with an ordering node named -
<code class="docutils literal notranslate"><span class="pre">orderer.example.com</span></code> that is tied to an MSP ID of <code class="docutils literal notranslate"><span class="pre">Orderer</span></code>.  This file
contains extensive documentation on the definitions and syntax.  You can also
refer to the <a class="reference internal" href="msp.html"><span class="doc">Membership Service Providers (MSP)</span></a> documentation for a deeper dive on MSP.</p>
<p>After we run the <code class="docutils literal notranslate"><span class="pre">cryptogen</span></code> tool, the generated certificates and keys will be
saved to a folder titled <code class="docutils literal notranslate"><span class="pre">crypto-config</span></code>.</p>
</div>
</div>
<div class="section" id="configuration-transaction-generator">
<h2>Configuration Transaction Generator<a class="headerlink" href="#configuration-transaction-generator" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">configtxgen</span> <span class="pre">tool</span></code> is used to create four configuration artifacts:</p>
<blockquote>
<div><ul class="simple">
<li>orderer <code class="docutils literal notranslate"><span class="pre">genesis</span> <span class="pre">block</span></code>,</li>
<li>channel <code class="docutils literal notranslate"><span class="pre">configuration</span> <span class="pre">transaction</span></code>,</li>
<li>and two <code class="docutils literal notranslate"><span class="pre">anchor</span> <span class="pre">peer</span> <span class="pre">transactions</span></code> - one for each Peer Org.</li>
</ul>
</div></blockquote>
<p>Please see <span class="xref std std-doc">configtxgen</span> for a complete description of this tool’s functionality.</p>
<p>The orderer block is the <a class="reference internal" href="glossary.html#genesis-block"><span class="std std-ref">Genesis Block</span></a> for the ordering service, and the
channel configuration transaction file is broadcast to the orderer at <a class="reference internal" href="glossary.html#channel"><span class="std std-ref">Channel</span></a> creation
time.  The anchor peer transactions, as the name might suggest, specify each
Org’s <a class="reference internal" href="glossary.html#anchor-peer"><span class="std std-ref">Anchor Peer</span></a> on this channel.</p>
<div class="section" id="id1">
<h3>How does it work?<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Configtxgen consumes a file - <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> - that contains the definitions
for the sample network. There are three members - one Orderer Org (<code class="docutils literal notranslate"><span class="pre">OrdererOrg</span></code>)
and two Peer Orgs (<code class="docutils literal notranslate"><span class="pre">Org1</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">Org2</span></code>) each managing and maintaining two peer nodes.
This file also specifies a consortium - <code class="docutils literal notranslate"><span class="pre">SampleConsortium</span></code> - consisting of our
two Peer Orgs.  Pay specific attention to the “Profiles” section at the top of
this file.  You will notice that we have two unique headers. One for the orderer genesis
block - <code class="docutils literal notranslate"><span class="pre">TwoOrgsOrdererGenesis</span></code> - and one for our channel - <code class="docutils literal notranslate"><span class="pre">TwoOrgsChannel</span></code>.</p>
<p>These headers are important, as we will pass them in as arguments when we create
our artifacts.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice that our <code class="docutils literal notranslate"><span class="pre">SampleConsortium</span></code> is defined in
the system-level profile and then referenced by
our channel-level profile.  Channels exist within
the purview of a consortium, and all consortia
must be defined in the scope of the network at
large.</p>
</div>
<p>This file also contains two additional specifications that are worth
noting. Firstly, we specify the anchor peers for each Peer Org
(<code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">peer0.org2.example.com</span></code>).  Secondly, we point to
the location of the MSP directory for each member, in turn allowing us to store the
root certificates for each Org in the orderer genesis block.  This is a critical
concept. Now any network entity communicating with the ordering service can have
its digital signature verified.</p>
</div>
</div>
<div class="section" id="run-the-tools">
<h2>Run the tools<a class="headerlink" href="#run-the-tools" title="Permalink to this headline">¶</a></h2>
<p>You can manually generate the certificates/keys and the various configuration
artifacts using the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> and <code class="docutils literal notranslate"><span class="pre">cryptogen</span></code> commands. Alternately,
you could try to adapt the byfn.sh script to accomplish your objectives.</p>
<div class="section" id="manually-generate-the-artifacts">
<h3>Manually generate the artifacts<a class="headerlink" href="#manually-generate-the-artifacts" title="Permalink to this headline">¶</a></h3>
<p>You can refer to the <code class="docutils literal notranslate"><span class="pre">generateCerts</span></code> function in the byfn.sh script for the
commands necessary to generate the certificates that will be used for your
network configuration as defined in the <code class="docutils literal notranslate"><span class="pre">crypto-config.yaml</span></code> file. However,
for the sake of convenience, we will also provide a reference here.</p>
<p>First let’s run the <code class="docutils literal notranslate"><span class="pre">cryptogen</span></code> tool.  Our binary is in the <code class="docutils literal notranslate"><span class="pre">bin</span></code>
directory, so we need to provide the relative path to where the tool resides.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">cryptogen</span> <span class="n">generate</span> <span class="o">--</span><span class="n">config</span><span class="o">=./</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>You should see the following in your terminal:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">org1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">org2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>The certs and keys (i.e. the MSP material) will be output into a directory - <code class="docutils literal notranslate"><span class="pre">crypto-config</span></code> -
at the root of the <code class="docutils literal notranslate"><span class="pre">first-network</span></code> directory.</p>
<p>Next, we need to tell the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool where to look for the
<code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> file that it needs to ingest.  We will tell it look in our
present working directory:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>export FABRIC_CFG_PATH=$PWD
</pre></div>
</div>
<p>Then, we’ll invoke the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool to create the orderer genesis block:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">configtxgen</span> <span class="o">-</span><span class="n">profile</span> <span class="n">TwoOrgsOrdererGenesis</span> <span class="o">-</span><span class="n">outputBlock</span> <span class="o">./</span><span class="n">channel</span><span class="o">-</span><span class="n">artifacts</span><span class="o">/</span><span class="n">genesis</span><span class="o">.</span><span class="n">block</span>
</pre></div>
</div>
<p>You should see an output similar to the following in your terminal:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span> <span class="mi">19</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mf">56.301</span> <span class="n">EDT</span> <span class="p">[</span><span class="n">common</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">configtxgen</span><span class="p">]</span> <span class="n">main</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">001</span> <span class="n">Loading</span> <span class="n">configuration</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span> <span class="mi">19</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mf">56.309</span> <span class="n">EDT</span> <span class="p">[</span><span class="n">common</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">configtxgen</span><span class="p">]</span> <span class="n">doOutputBlock</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">002</span> <span class="n">Generating</span> <span class="n">genesis</span> <span class="n">block</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span> <span class="mi">19</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mf">56.309</span> <span class="n">EDT</span> <span class="p">[</span><span class="n">common</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">configtxgen</span><span class="p">]</span> <span class="n">doOutputBlock</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">003</span> <span class="n">Writing</span> <span class="n">genesis</span> <span class="n">block</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The orderer genesis block and the subsequent artifacts we are about to create
will be output into the <code class="docutils literal notranslate"><span class="pre">channel-artifacts</span></code> directory at the root of this
project.</p>
</div>
</div>
<div class="section" id="create-a-channel-configuration-transaction">
<span id="createchanneltx"></span><h3>Create a Channel Configuration Transaction<a class="headerlink" href="#create-a-channel-configuration-transaction" title="Permalink to this headline">¶</a></h3>
<p>Next, we need to create the channel transaction artifact. Be sure to replace <code class="docutils literal notranslate"><span class="pre">$CHANNEL_NAME</span></code> or
set <code class="docutils literal notranslate"><span class="pre">CHANNEL_NAME</span></code> as an environment variable that can be used throughout these instructions:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span># The channel.tx artifact contains the definitions for our sample channel

export CHANNEL_NAME=mychannel  &amp;&amp; ../bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME
</pre></div>
</div>
<p>You should see an ouput similar to the following in your terminal:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span> <span class="mi">19</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mf">05.324</span> <span class="n">EDT</span> <span class="p">[</span><span class="n">common</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">configtxgen</span><span class="p">]</span> <span class="n">main</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">001</span> <span class="n">Loading</span> <span class="n">configuration</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span> <span class="mi">19</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mf">05.329</span> <span class="n">EDT</span> <span class="p">[</span><span class="n">common</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">configtxgen</span><span class="p">]</span> <span class="n">doOutputChannelCreateTx</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">002</span> <span class="n">Generating</span> <span class="n">new</span> <span class="n">channel</span> <span class="n">configtx</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span> <span class="mi">19</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mf">05.329</span> <span class="n">EDT</span> <span class="p">[</span><span class="n">common</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">configtxgen</span><span class="p">]</span> <span class="n">doOutputChannelCreateTx</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">003</span> <span class="n">Writing</span> <span class="n">new</span> <span class="n">channel</span> <span class="n">tx</span>
</pre></div>
</div>
<p>Next, we will define the anchor peer for Org1 on the channel that we are
constructing. Again, be sure to replace <code class="docutils literal notranslate"><span class="pre">$CHANNEL_NAME</span></code> or set the environment variable
for the following commands.  The terminal output will mimic that of the channel transaction artifact:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP
</pre></div>
</div>
<p>Now, we will define the anchor peer for Org2 on the same channel:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP
</pre></div>
</div>
</div>
</div>
<div class="section" id="start-the-network">
<h2>Start the network<a class="headerlink" href="#start-the-network" title="Permalink to this headline">¶</a></h2>
<p>We will leverage a script to spin up our network. The
docker-compose file references the images that we have previously downloaded,
and bootstraps the orderer with our previously generated <code class="docutils literal notranslate"><span class="pre">genesis.block</span></code>.</p>
<p>We want to go through the commands manually in order to expose the
syntax and functionality of each call.</p>
<p>First let’s start your network:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">cli</span><span class="o">.</span><span class="n">yaml</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p>If you want to see the realtime logs for your network, then do not supply the <code class="docutils literal notranslate"><span class="pre">-d</span></code> flag.
If you let the logs stream, then you will need to open a second terminal to execute the CLI calls.</p>
<p>The CLI container will stick around idle for 1000 seconds. If it’s gone when you need it you can restart it with a simple command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">start</span> <span class="n">cli</span>
</pre></div>
</div>
<div class="section" id="environment-variables">
<span id="peerenvvars"></span><h3>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p>For the following CLI commands against <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> to work, we need
to preface our commands with the four environment variables given below.  These
variables for <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> are baked into the CLI container,
therefore we can operate without passing them.  <strong>HOWEVER</strong>, if you want to send
calls to other peers or the orderer, then you will need to provide these
values accordingly.  Inspect the <code class="docutils literal notranslate"><span class="pre">docker-compose-base.yaml</span></code> for the specific
paths:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Environment variables for PEER0</span>

<span class="n">CORE_PEER_MSPCONFIGPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">peer</span><span class="o">/</span><span class="n">crypto</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">Admin</span><span class="nd">@org1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span>
<span class="n">CORE_PEER_ADDRESS</span><span class="o">=</span><span class="n">peer0</span><span class="o">.</span><span class="n">org1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">7051</span>
<span class="n">CORE_PEER_LOCALMSPID</span><span class="o">=</span><span class="s2">&quot;Org1MSP&quot;</span>
<span class="n">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">peer</span><span class="o">/</span><span class="n">crypto</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">peers</span><span class="o">/</span><span class="n">peer0</span><span class="o">.</span><span class="n">org1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">crt</span>
</pre></div>
</div>
</div>
<div class="section" id="create-join-channel">
<span id="createandjoin"></span><h3>Create &amp; Join Channel<a class="headerlink" href="#create-join-channel" title="Permalink to this headline">¶</a></h3>
<p>Recall that we created the channel configuration transaction using the
<code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool in the <a class="reference internal" href="#createchanneltx"><span class="std std-ref">Create a Channel Configuration Transaction</span></a> section, above. You can
repeat that process to create additional channel configuration transactions,
using the same or different profiles in the <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> that you pass
to the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool. Then you can repeat the process defined in this
section to establish those other channels in your network.</p>
<p>We will enter the CLI container using the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span></code> command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">cli</span> <span class="n">bash</span>
</pre></div>
</div>
<p>If successful you should see the following:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@0d78bb69300d</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">peer</span><span class="c1">#</span>
</pre></div>
</div>
<p>Next, we are going to pass in the generated channel configuration transaction
artifact that we created in the <a class="reference internal" href="#createchanneltx"><span class="std std-ref">Create a Channel Configuration Transaction</span></a> section (we called
it <code class="docutils literal notranslate"><span class="pre">channel.tx</span></code>) to the orderer as part of the create channel request.</p>
<p>We specify our channel name with the <code class="docutils literal notranslate"><span class="pre">-c</span></code> flag and our channel configuration
transaction with the <code class="docutils literal notranslate"><span class="pre">-f</span></code> flag. In this case it is <code class="docutils literal notranslate"><span class="pre">channel.tx</span></code>, however
you can mount your own configuration transaction with a different name.  Once again
we will set the <code class="docutils literal notranslate"><span class="pre">CHANNEL_NAME</span></code> environment variable within our CLI container so that
we don’t have to explicitly pass this argument:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>export CHANNEL_NAME=mychannel

# the channel.tx file is mounted in the channel-artifacts directory within your CLI container
# as a result, we pass the full path for the file
# we also pass the path for the orderer ca-cert in order to verify the TLS handshake
# be sure to export or replace the $CHANNEL_NAME variable appropriately

peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice the <code class="docutils literal notranslate"><span class="pre">--</span> <span class="pre">cafile</span></code> that we pass as part of this command.  It is
the local path to the orderer’s root cert, allowing us to verify the
TLS handshake.</p>
</div>
<p>This command returns a genesis block - <code class="docutils literal notranslate"><span class="pre">&lt;channel-ID.block&gt;</span></code> - which we will use to join the channel.
It contains the configuration information specified in <code class="docutils literal notranslate"><span class="pre">channel.tx</span></code>  If you have not
made any modifications to the default channel name, then the command will return you a
proto titled <code class="docutils literal notranslate"><span class="pre">mychannel.block</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You will remain in the CLI container for the remainder of
these manual commands. You must also remember to preface all commands
with the corresponding environment variables when targeting a peer other than
<code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code>.</p>
</div>
<p>Now let’s join <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> to the channel.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># By default, this joins ``peer0.org1.example.com`` only</span>
<span class="c1"># the &lt;channel-ID.block&gt; was returned by the previous command</span>
<span class="c1"># if you have not modified the channel name, you will join with mychannel.block</span>
<span class="c1"># if you have created a different channel name, then pass in the appropriately named block</span>

 <span class="n">peer</span> <span class="n">channel</span> <span class="n">join</span> <span class="o">-</span><span class="n">b</span> <span class="n">mychannel</span><span class="o">.</span><span class="n">block</span>
</pre></div>
</div>
<p>You can make other peers join the channel as necessary by making appropriate
changes in the four environment variables we used in the <a class="reference internal" href="#peerenvvars"><span class="std std-ref">Environment variables</span></a>
section, above.</p>
<p>Rather than join every peer, we will simply join <code class="docutils literal notranslate"><span class="pre">peer0.org2.example.com</span></code> so that
we can properly update the anchor peer definitions in our channel.  Since we are
overriding the default environment variables baked into the CLI container, this full
command will be the following:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CORE_PEER_MSPCONFIGPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">peer</span><span class="o">/</span><span class="n">crypto</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">Admin</span><span class="nd">@org2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span> <span class="n">CORE_PEER_ADDRESS</span><span class="o">=</span><span class="n">peer0</span><span class="o">.</span><span class="n">org2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">7051</span> <span class="n">CORE_PEER_LOCALMSPID</span><span class="o">=</span><span class="s2">&quot;Org2MSP&quot;</span> <span class="n">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">peer</span><span class="o">/</span><span class="n">crypto</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">peers</span><span class="o">/</span><span class="n">peer0</span><span class="o">.</span><span class="n">org2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">crt</span> <span class="n">peer</span> <span class="n">channel</span> <span class="n">join</span> <span class="o">-</span><span class="n">b</span> <span class="n">mychannel</span><span class="o">.</span><span class="n">block</span>
</pre></div>
</div>
<p>Alternatively, you could choose to set these environment variables individually
rather than passing in the entire string.  Once they’ve been set, you simply need
to issue the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">join</span></code> command again and the CLI container will act
on behalf of <code class="docutils literal notranslate"><span class="pre">peer0.org2.example.com</span></code>.</p>
</div>
<div class="section" id="update-the-anchor-peers">
<h3>Update the anchor peers<a class="headerlink" href="#update-the-anchor-peers" title="Permalink to this headline">¶</a></h3>
<p>The following commands are channel updates and they will propagate to the definition
of the channel.  In essence, we adding additional configuration information on top
of the channel’s genesis block.  Note that we are not modifying the genesis block, but
simply adding deltas into the chain that will define the anchor peers.</p>
<p>Update the channel definition to define the anchor peer for Org1 as <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/Org1MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</pre></div>
</div>
<p>Now update the channel definition to define the anchor peer for Org2 as <code class="docutils literal notranslate"><span class="pre">peer0.org2.example.com</span></code>.
Identically to the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">join</span></code> command for the Org2 peer, we will need to
preface this call with the appropriate environment variables.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_ADDRESS=peer0.org2.example.com:7051 CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot; CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/Org2MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</pre></div>
</div>
</div>
<div class="section" id="install-instantiate-chaincode">
<h3>Install &amp; Instantiate Chaincode<a class="headerlink" href="#install-instantiate-chaincode" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We will utilize a simple existing chaincode. To learn how to write
your own chaincode, see the <a class="reference internal" href="chaincode4ade.html"><span class="doc">Chaincode for Developers</span></a> tutorial.</p>
</div>
<p>Applications interact with the blockchain ledger through <code class="docutils literal notranslate"><span class="pre">chaincode</span></code>.  As
such we need to install the chaincode on every peer that will execute and
endorse our transactions, and then instantiate the chaincode on the channel.</p>
<p>First, install the sample Go or Node.js chaincode onto one of the four peer nodes.  These commands
place the specified source code flavor onto our peer’s filesystem.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can only install one version of the source code per chaincode name
and version.  The source code exists on the peer’s file system in the
context of chaincode name and version; it is language agnostic.  Similarly
the instantiated chaincode container will be reflective of whichever
language has been installed on the peer.</p>
</div>
<p><strong>Golang</strong></p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this installs the Go chaincode</span>
<span class="n">peer</span> <span class="n">chaincode</span> <span class="n">install</span> <span class="o">-</span><span class="n">n</span> <span class="n">mycc</span> <span class="o">-</span><span class="n">v</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">p</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">chaincode</span><span class="o">/</span><span class="n">chaincode_example02</span><span class="o">/</span><span class="n">go</span><span class="o">/</span>
</pre></div>
</div>
<p><strong>Node.js</strong></p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this installs the Node.js chaincode</span>
<span class="c1"># make note of the -l flag; we use this to specify the language</span>
<span class="n">peer</span> <span class="n">chaincode</span> <span class="n">install</span> <span class="o">-</span><span class="n">n</span> <span class="n">mycc</span> <span class="o">-</span><span class="n">v</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">l</span> <span class="n">node</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">chaincode</span><span class="o">/</span><span class="n">chaincode_example02</span><span class="o">/</span><span class="n">node</span><span class="o">/</span>
</pre></div>
</div>
<p>Next, instantiate the chaincode on the channel. This will initialize the
chaincode on the channel, set the endorsement policy for the chaincode, and
launch a chaincode container for the targeted peer.  Take note of the <code class="docutils literal notranslate"><span class="pre">-P</span></code>
argument. This is our policy where we specify the required level of endorsement
for a transaction against this chaincode to be validated.</p>
<p>In the command below you’ll notice that we specify our policy as
<code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">&quot;OR</span> <span class="pre">('Org0MSP.peer','Org1MSP.peer')&quot;</span></code>. This means that we need
“endorsement” from a peer belonging to Org1 <strong>OR</strong> Org2 (i.e. only one endorsement).
If we changed the syntax to <code class="docutils literal notranslate"><span class="pre">AND</span></code> then we would need two endorsements.</p>
<p><strong>Golang</strong></p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span># be sure to replace the $CHANNEL_NAME environment variable if you have not exported it
# if you did not install your chaincode with a name of mycc, then modify that argument as well

peer chaincode instantiate -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc -v 1.0 -c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;, &quot;100&quot;, &quot;b&quot;,&quot;200&quot;]}&#39; -P &quot;OR (&#39;Org1MSP.peer&#39;,&#39;Org2MSP.peer&#39;)&quot;
</pre></div>
</div>
<p><strong>Node.js</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The instantiation of the Node.js chaincode will take roughly a minute.
The command is not hanging; rather it is installing the fabric-shim
layer as the image is being compiled.</p>
</div>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span># be sure to replace the $CHANNEL_NAME environment variable if you have not exported it
# if you did not install your chaincode with a name of mycc, then modify that argument as well
# notice that we must pass the -l flag after the chaincode name to identify the language

peer chaincode instantiate -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc -l node -v 1.0 -c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;, &quot;100&quot;, &quot;b&quot;,&quot;200&quot;]}&#39; -P &quot;OR (&#39;Org1MSP.peer&#39;,&#39;Org2MSP.peer&#39;)&quot;
</pre></div>
</div>
<p>See the <a class="reference external" href="http://hyperledger-fabric.readthedocs.io/en/latest/endorsement-policies.html">endorsement
policies</a>
documentation for more details on policy implementation.</p>
<p>If you want additional peers to interact with ledger, then you will need to join
them to the channel, and install the same name, version and language of the
chaincode source onto the appropriate peer’s filesystem.  A chaincode container
will be launched for each peer as soon as they try to interact with that specific
chaincode.  Again, be cognizant of the fact that the Node.js images will be slower
to compile.</p>
<p>Once the chaincode has been instantiated on the channel, we can forgo the <code class="docutils literal notranslate"><span class="pre">l</span></code>
flag.  We need only pass in the channel identifier and name of the chaincode.</p>
</div>
<div class="section" id="query">
<h3>Query<a class="headerlink" href="#query" title="Permalink to this headline">¶</a></h3>
<p>Let’s query for the value of <code class="docutils literal notranslate"><span class="pre">a</span></code> to make sure the chaincode was properly
instantiated and the state DB was populated. The syntax for query is as follows:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span># be sure to set the -C and -n flags appropriately

peer chaincode query -C $CHANNEL_NAME -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]}&#39;
</pre></div>
</div>
</div>
<div class="section" id="invoke">
<h3>Invoke<a class="headerlink" href="#invoke" title="Permalink to this headline">¶</a></h3>
<p>Now let’s move <code class="docutils literal notranslate"><span class="pre">10</span></code> from <code class="docutils literal notranslate"><span class="pre">a</span></code> to <code class="docutils literal notranslate"><span class="pre">b</span></code>.  This transaction will cut a new block and
update the state DB. The syntax for invoke is as follows:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span># be sure to set the -C and -n flags appropriately

peer chaincode invoke -o orderer.example.com:7050  --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem  -C $CHANNEL_NAME -n mycc -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]}&#39;
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Query<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Let’s confirm that our previous invocation executed properly. We initialized the
key <code class="docutils literal notranslate"><span class="pre">a</span></code> with a value of <code class="docutils literal notranslate"><span class="pre">100</span></code> and just removed <code class="docutils literal notranslate"><span class="pre">10</span></code> with our previous
invocation. Therefore, a query against <code class="docutils literal notranslate"><span class="pre">a</span></code> should reveal <code class="docutils literal notranslate"><span class="pre">90</span></code>. The syntax
for query is as follows.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span># be sure to set the -C and -n flags appropriately

peer chaincode query -C $CHANNEL_NAME -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]}&#39;
</pre></div>
</div>
<p>We should see the following:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Query</span> <span class="n">Result</span><span class="p">:</span> <span class="mi">90</span>
</pre></div>
</div>
<p>Feel free to start over and manipulate the key value pairs and subsequent
invocations.</p>
</div>
<div class="section" id="what-s-happening-behind-the-scenes">
<span id="behind-scenes"></span><h3>What’s happening behind the scenes?<a class="headerlink" href="#what-s-happening-behind-the-scenes" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These steps describe the scenario in which
<code class="docutils literal notranslate"><span class="pre">script.sh</span></code> is run by ‘./byfn.sh up’.  Clean your network
with <code class="docutils literal notranslate"><span class="pre">./byfn.sh</span> <span class="pre">down</span></code> and ensure
this command is active.  Then use the same
docker-compose prompt to launch your network again</p>
</div>
<ul class="simple">
<li>A script - <code class="docutils literal notranslate"><span class="pre">script.sh</span></code> - is baked inside the CLI container. The
script drives the <code class="docutils literal notranslate"><span class="pre">createChannel</span></code> command against the supplied channel name
and uses the channel.tx file for channel configuration.</li>
<li>The output of <code class="docutils literal notranslate"><span class="pre">createChannel</span></code> is a genesis block -
<code class="docutils literal notranslate"><span class="pre">&lt;your_channel_name&gt;.block</span></code> - which gets stored on the peers’ file systems and contains
the channel configuration specified from channel.tx.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">joinChannel</span></code> command is exercised for all four peers, which takes as
input the previously generated genesis block.  This command instructs the
peers to join <code class="docutils literal notranslate"><span class="pre">&lt;your_channel_name&gt;</span></code> and create a chain starting with <code class="docutils literal notranslate"><span class="pre">&lt;your_channel_name&gt;.block</span></code>.</li>
<li>Now we have a channel consisting of four peers, and two
organizations.  This is our <code class="docutils literal notranslate"><span class="pre">TwoOrgsChannel</span></code> profile.</li>
<li><code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> and <code class="docutils literal notranslate"><span class="pre">peer1.org1.example.com</span></code> belong to Org1;
<code class="docutils literal notranslate"><span class="pre">peer0.org2.example.com</span></code> and <code class="docutils literal notranslate"><span class="pre">peer1.org2.example.com</span></code> belong to Org2</li>
<li>These relationships are defined through the <code class="docutils literal notranslate"><span class="pre">crypto-config.yaml</span></code> and
the MSP path is specified in our docker compose.</li>
<li>The anchor peers for Org1MSP (<code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code>) and
Org2MSP (<code class="docutils literal notranslate"><span class="pre">peer0.org2.example.com</span></code>) are then updated.  We do this by passing
the <code class="docutils literal notranslate"><span class="pre">Org1MSPanchors.tx</span></code> and <code class="docutils literal notranslate"><span class="pre">Org2MSPanchors.tx</span></code> artifacts to the ordering
service along with the name of our channel.</li>
<li>A chaincode - <strong>chaincode_example02</strong> - is installed on <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> and
<code class="docutils literal notranslate"><span class="pre">peer0.org2.example.com</span></code></li>
<li>The chaincode is then “instantiated” on <code class="docutils literal notranslate"><span class="pre">peer0.org2.example.com</span></code>. Instantiation
adds the chaincode to the channel, starts the container for the target peer,
and initializes the key value pairs associated with the chaincode.  The initial
values for this example are [“a”,”100” “b”,”200”]. This “instantiation” results
in a container by the name of <code class="docutils literal notranslate"><span class="pre">dev-peer0.org2.example.com-mycc-1.0</span></code> starting.</li>
<li>The instantiation also passes in an argument for the endorsement
policy. The policy is defined as
<code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">&quot;OR</span>&#160;&#160;&#160; <span class="pre">('Org1MSP.peer','Org2MSP.peer')&quot;</span></code>, meaning that any
transaction must be endorsed by a peer tied to Org1 or Org2.</li>
<li>A query against the value of “a” is issued to <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code>. The
chaincode was previously installed on <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code>, so this will start
a container for Org1 peer0 by the name of <code class="docutils literal notranslate"><span class="pre">dev-peer0.org1.example.com-mycc-1.0</span></code>. The result
of the query is also returned. No write operations have occurred, so
a query against “a” will still return a value of “100”.</li>
<li>An invoke is sent to <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> to move “10” from “a” to “b”</li>
<li>The chaincode is then installed on <code class="docutils literal notranslate"><span class="pre">peer1.org2.example.com</span></code></li>
<li>A query is sent to <code class="docutils literal notranslate"><span class="pre">peer1.org2.example.com</span></code> for the value of “a”. This starts a
third chaincode container by the name of <code class="docutils literal notranslate"><span class="pre">dev-peer1.org2.example.com-mycc-1.0</span></code>. A
value of 90 is returned, correctly reflecting the previous
transaction during which the value for key “a” was modified by 10.</li>
</ul>
</div>
<div class="section" id="what-does-this-demonstrate">
<h3>What does this demonstrate?<a class="headerlink" href="#what-does-this-demonstrate" title="Permalink to this headline">¶</a></h3>
<p>Chaincode <strong>MUST</strong> be installed on a peer in order for it to
successfully perform read/write operations against the ledger.
Furthermore, a chaincode container is not started for a peer until an <code class="docutils literal notranslate"><span class="pre">init</span></code> or
traditional transaction - read/write - is performed against that chaincode (e.g. query for
the value of “a”). The transaction causes the container to start. Also,
all peers in a channel maintain an exact copy of the ledger which
comprises the blockchain to store the immutable, sequenced record in
blocks, as well as a state database to maintain a snapshot of the current state.
This includes those peers that do not have chaincode installed on them
(like <code class="docutils literal notranslate"><span class="pre">peer1.org1.example.com</span></code> in the above example) . Finally, the chaincode is accessible
after it is installed (like <code class="docutils literal notranslate"><span class="pre">peer1.org2.example.com</span></code> in the above example) because it
has already been instantiated.</p>
</div>
<div class="section" id="how-do-i-see-these-transactions">
<h3>How do I see these transactions?<a class="headerlink" href="#how-do-i-see-these-transactions" title="Permalink to this headline">¶</a></h3>
<p>Check the logs for the CLI Docker container.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="n">cli</span>
</pre></div>
</div>
<p>You should see the following output:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span> <span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">01.366</span> <span class="n">UTC</span> <span class="p">[</span><span class="n">msp</span><span class="p">]</span> <span class="n">GetLocalMSP</span> <span class="o">-&gt;</span> <span class="n">DEBU</span> <span class="mi">004</span> <span class="n">Returning</span> <span class="n">existing</span> <span class="n">local</span> <span class="n">MSP</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span> <span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">01.366</span> <span class="n">UTC</span> <span class="p">[</span><span class="n">msp</span><span class="p">]</span> <span class="n">GetDefaultSigningIdentity</span> <span class="o">-&gt;</span> <span class="n">DEBU</span> <span class="mi">005</span> <span class="n">Obtaining</span> <span class="n">default</span> <span class="n">signing</span> <span class="n">identity</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span> <span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">01.366</span> <span class="n">UTC</span> <span class="p">[</span><span class="n">msp</span><span class="o">/</span><span class="n">identity</span><span class="p">]</span> <span class="n">Sign</span> <span class="o">-&gt;</span> <span class="n">DEBU</span> <span class="mi">006</span> <span class="n">Sign</span><span class="p">:</span> <span class="n">plaintext</span><span class="p">:</span> <span class="mi">0</span><span class="n">AB1070A6708031A0C08F1E3ECC80510</span><span class="o">...</span><span class="mi">6</span><span class="n">D7963631A0A0A0571756572790A0161</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span> <span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">01.367</span> <span class="n">UTC</span> <span class="p">[</span><span class="n">msp</span><span class="o">/</span><span class="n">identity</span><span class="p">]</span> <span class="n">Sign</span> <span class="o">-&gt;</span> <span class="n">DEBU</span> <span class="mi">007</span> <span class="n">Sign</span><span class="p">:</span> <span class="n">digest</span><span class="p">:</span> <span class="n">E61DB37F4E8B0D32C9FE10E3936BA9B8CD278FAA1F3320B08712164248285C54</span>
<span class="n">Query</span> <span class="n">Result</span><span class="p">:</span> <span class="mi">90</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span> <span class="mi">17</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">15.158</span> <span class="n">UTC</span> <span class="p">[</span><span class="n">main</span><span class="p">]</span> <span class="n">main</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">008</span> <span class="n">Exiting</span><span class="o">.....</span>
<span class="o">=====================</span> <span class="n">Query</span> <span class="n">on</span> <span class="n">peer1</span><span class="o">.</span><span class="n">org2</span> <span class="n">on</span> <span class="n">channel</span> <span class="s1">&#39;mychannel&#39;</span> <span class="ow">is</span> <span class="n">successful</span> <span class="o">=====================</span>

<span class="o">=====================</span> <span class="n">All</span> <span class="n">GOOD</span><span class="p">,</span> <span class="n">BYFN</span> <span class="n">execution</span> <span class="n">completed</span> <span class="o">=====================</span>


 <span class="n">_____</span>   <span class="n">_</span>   <span class="n">_</span>   <span class="n">____</span>
<span class="o">|</span> <span class="n">____</span><span class="o">|</span> <span class="o">|</span> \ <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">_</span> \
<span class="o">|</span>  <span class="n">_</span><span class="o">|</span>   <span class="o">|</span>  \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">|</span><span class="n">___</span>  <span class="o">|</span> <span class="o">|</span>\  <span class="o">|</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
<span class="o">|</span><span class="n">_____</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> \<span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">____</span><span class="o">/</span>
</pre></div>
</div>
<p>You can scroll through these logs to see the various transactions.</p>
</div>
<div class="section" id="how-can-i-see-the-chaincode-logs">
<h3>How can I see the chaincode logs?<a class="headerlink" href="#how-can-i-see-the-chaincode-logs" title="Permalink to this headline">¶</a></h3>
<p>Inspect the individual chaincode containers to see the separate
transactions executed against each container. Here is the combined
output from each container:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker logs dev-peer0.org2.example.com-mycc-1.0
04:30:45.947 [BCCSP_FACTORY] DEBU : Initialize BCCSP [SW]
ex02 Init
Aval = 100, Bval = 200

$ docker logs dev-peer0.org1.example.com-mycc-1.0
04:31:10.569 [BCCSP_FACTORY] DEBU : Initialize BCCSP [SW]
ex02 Invoke
Query Response:{&quot;Name&quot;:&quot;a&quot;,&quot;Amount&quot;:&quot;100&quot;}
ex02 Invoke
Aval = 90, Bval = 210

$ docker logs dev-peer1.org2.example.com-mycc-1.0
04:31:30.420 [BCCSP_FACTORY] DEBU : Initialize BCCSP [SW]
ex02 Invoke
Query Response:{&quot;Name&quot;:&quot;a&quot;,&quot;Amount&quot;:&quot;90&quot;}
</pre></div>
</div>
</div>
</div>
<div class="section" id="understanding-the-docker-compose-topology">
<h2>Understanding the Docker Compose topology<a class="headerlink" href="#understanding-the-docker-compose-topology" title="Permalink to this headline">¶</a></h2>
<p>The BYFN sample offers us two flavors of Docker Compose files, both of which
are extended from the <code class="docutils literal notranslate"><span class="pre">docker-compose-base.yaml</span></code> (located in the <code class="docutils literal notranslate"><span class="pre">base</span></code>
folder).  Our first flavor, <code class="docutils literal notranslate"><span class="pre">docker-compose-cli.yaml</span></code>, provides us with a
CLI container, along with an orderer, four peers.  We use this file
for the entirety of the instructions on this page.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the remainder of this section covers a docker-compose file designed for the
SDK.  Refer to the <a class="reference external" href="https://github.com/hyperledger/fabric-sdk-node">Node SDK</a>
repo for details on running these tests.</p>
</div>
<p>The second flavor, <code class="docutils literal notranslate"><span class="pre">docker-compose-e2e.yaml</span></code>, is constructed to run end-to-end tests
using the Node.js SDK.  Aside from functioning with the SDK, its primary differentiation
is that there are containers for the fabric-ca servers.  As a result, we are able
to send REST calls to the organizational CAs for user registration and enrollment.</p>
<p>If you want to use the <code class="docutils literal notranslate"><span class="pre">docker-compose-e2e.yaml</span></code> without first running the
byfn.sh script, then we will need to make four slight modifications.
We need to point to the private keys for our Organization’s CA’s.  You can locate
these values in your crypto-config folder.  For example, to locate the private
key for Org1 we would follow this path - <code class="docutils literal notranslate"><span class="pre">crypto-config/peerOrganizations/org1.example.com/ca/</span></code>.
The private key is a long hash value followed by <code class="docutils literal notranslate"><span class="pre">_sk</span></code>.  The path for Org2
would be - <code class="docutils literal notranslate"><span class="pre">crypto-config/peerOrganizations/org2.example.com/ca/</span></code>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">docker-compose-e2e.yaml</span></code> update the FABRIC_CA_SERVER_TLS_KEYFILE variable
for ca0 and ca1.  You also need to edit the path that is provided in the command
to start the ca server.  You are providing the same private key twice for each
CA container.</p>
</div>
<div class="section" id="using-couchdb">
<h2>Using CouchDB<a class="headerlink" href="#using-couchdb" title="Permalink to this headline">¶</a></h2>
<p>The state database can be switched from the default (goleveldb) to CouchDB.
The same chaincode functions are available with CouchDB, however, there is the
added ability to perform rich and complex queries against the state database
data content contingent upon the chaincode data being modeled as JSON.</p>
<p>To use CouchDB instead of the default database (goleveldb), follow the same
procedures outlined earlier for generating the artifacts, except when starting
the network pass <code class="docutils literal notranslate"><span class="pre">docker-compose-couch.yaml</span></code> as well:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">cli</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">couch</span><span class="o">.</span><span class="n">yaml</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p><strong>chaincode_example02</strong> should now work using CouchDB underneath.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you choose to implement mapping of the fabric-couchdb container
port to a host port, please make sure you are aware of the security
implications. Mapping of the port in a development environment makes the
CouchDB REST API available, and allows the
visualization of the database via the CouchDB web interface (Fauxton).
Production environments would likely refrain from implementing port mapping in
order to restrict outside access to the CouchDB containers.</p>
</div>
<p>You can use <strong>chaincode_example02</strong> chaincode against the CouchDB state database
using the steps outlined above, however in order to exercise the CouchDB query
capabilities you will need to use a chaincode that has data modeled as JSON,
(e.g. <strong>marbles02</strong>). You can locate the <strong>marbles02</strong> chaincode in the
<code class="docutils literal notranslate"><span class="pre">fabric/examples/chaincode/go</span></code> directory.</p>
<p>We will follow the same process to create and join the channel as outlined in the
<a class="reference internal" href="#createandjoin"><span class="std std-ref">Create &amp; Join Channel</span></a> section above.  Once you have joined your peer(s) to the
channel, use the following steps to interact with the <strong>marbles02</strong> chaincode:</p>
<ul class="simple">
<li>Install and instantiate the chaincode on <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code>:</li>
</ul>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span># be sure to modify the $CHANNEL_NAME variable accordingly for the instantiate command

peer chaincode install -n marbles -v 1.0 -p github.com/chaincode/marbles02/go
peer chaincode instantiate -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n marbles -v 1.0 -c &#39;{&quot;Args&quot;:[&quot;init&quot;]}&#39; -P &quot;OR (&#39;Org0MSP.peer&#39;,&#39;Org1MSP.peer&#39;)&quot;
</pre></div>
</div>
<ul class="simple">
<li>Create some marbles and move them around:</li>
</ul>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span># be sure to modify the $CHANNEL_NAME variable accordingly

peer chaincode invoke -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;initMarble&quot;,&quot;marble1&quot;,&quot;blue&quot;,&quot;35&quot;,&quot;tom&quot;]}&#39;
peer chaincode invoke -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;initMarble&quot;,&quot;marble2&quot;,&quot;red&quot;,&quot;50&quot;,&quot;tom&quot;]}&#39;
peer chaincode invoke -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;initMarble&quot;,&quot;marble3&quot;,&quot;blue&quot;,&quot;70&quot;,&quot;tom&quot;]}&#39;
peer chaincode invoke -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;transferMarble&quot;,&quot;marble2&quot;,&quot;jerry&quot;]}&#39;
peer chaincode invoke -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;transferMarblesBasedOnColor&quot;,&quot;blue&quot;,&quot;jerry&quot;]}&#39;
peer chaincode invoke -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;delete&quot;,&quot;marble1&quot;]}&#39;
</pre></div>
</div>
<ul>
<li><p class="first">If you chose to map the CouchDB ports in docker-compose, you can now view
the state database through the CouchDB web interface (Fauxton) by opening
a browser and navigating to the following URL:</p>
<p><code class="docutils literal notranslate"><span class="pre">http://localhost:5984/_utils</span></code></p>
</li>
</ul>
<p>You should see a database named <code class="docutils literal notranslate"><span class="pre">mychannel</span></code> (or your unique channel name) and
the documents inside it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the below commands, be sure to update the $CHANNEL_NAME variable appropriately.</p>
</div>
<p>You can run regular queries from the CLI (e.g. reading <code class="docutils literal notranslate"><span class="pre">marble2</span></code>):</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>peer chaincode query -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;readMarble&quot;,&quot;marble2&quot;]}&#39;
</pre></div>
</div>
<p>The output should display the details of <code class="docutils literal notranslate"><span class="pre">marble2</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Query</span> <span class="n">Result</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;docType&quot;</span><span class="p">:</span><span class="s2">&quot;marble&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;marble2&quot;</span><span class="p">,</span><span class="s2">&quot;owner&quot;</span><span class="p">:</span><span class="s2">&quot;jerry&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">}</span>
</pre></div>
</div>
<p>You can retrieve the history of a specific marble - e.g. <code class="docutils literal notranslate"><span class="pre">marble1</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>peer chaincode query -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;getHistoryForMarble&quot;,&quot;marble1&quot;]}&#39;
</pre></div>
</div>
<p>The output should display the transactions on <code class="docutils literal notranslate"><span class="pre">marble1</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Query</span> <span class="n">Result</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;TxId&quot;</span><span class="p">:</span><span class="s2">&quot;1c3d3caf124c89f91a4c0f353723ac736c58155325f02890adebaa15e16e6464&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:{</span><span class="s2">&quot;docType&quot;</span><span class="p">:</span><span class="s2">&quot;marble&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;marble1&quot;</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span><span class="s2">&quot;owner&quot;</span><span class="p">:</span><span class="s2">&quot;tom&quot;</span><span class="p">}},{</span><span class="s2">&quot;TxId&quot;</span><span class="p">:</span><span class="s2">&quot;755d55c281889eaeebf405586f9e25d71d36eb3d35420af833a20a2f53a3eefd&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:{</span><span class="s2">&quot;docType&quot;</span><span class="p">:</span><span class="s2">&quot;marble&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;marble1&quot;</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span><span class="s2">&quot;owner&quot;</span><span class="p">:</span><span class="s2">&quot;jerry&quot;</span><span class="p">}},{</span><span class="s2">&quot;TxId&quot;</span><span class="p">:</span><span class="s2">&quot;819451032d813dde6247f85e56a89262555e04f14788ee33e28b232eef36d98f&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:}]</span>
</pre></div>
</div>
<p>You can also perform rich queries on the data content, such as querying marble fields by owner <code class="docutils literal notranslate"><span class="pre">jerry</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>peer chaincode query -C $CHANNEL_NAME -n marbles -c &#39;{&quot;Args&quot;:[&quot;queryMarblesByOwner&quot;,&quot;jerry&quot;]}&#39;
</pre></div>
</div>
<p>The output should display the two marbles owned by <code class="docutils literal notranslate"><span class="pre">jerry</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Query</span> <span class="n">Result</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;marble2&quot;</span><span class="p">,</span> <span class="s2">&quot;Record&quot;</span><span class="p">:{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;docType&quot;</span><span class="p">:</span><span class="s2">&quot;marble&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;marble2&quot;</span><span class="p">,</span><span class="s2">&quot;owner&quot;</span><span class="p">:</span><span class="s2">&quot;jerry&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">}},{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span><span class="s2">&quot;marble3&quot;</span><span class="p">,</span> <span class="s2">&quot;Record&quot;</span><span class="p">:{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="s2">&quot;docType&quot;</span><span class="p">:</span><span class="s2">&quot;marble&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;marble3&quot;</span><span class="p">,</span><span class="s2">&quot;owner&quot;</span><span class="p">:</span><span class="s2">&quot;jerry&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">70</span><span class="p">}}]</span>
</pre></div>
</div>
</div>
<div class="section" id="why-couchdb">
<h2>Why CouchDB<a class="headerlink" href="#why-couchdb" title="Permalink to this headline">¶</a></h2>
<p>CouchDB is a kind of NoSQL solution. It is a document oriented database where document fields are stored as key-value mpas. Fields can be either a simple key/value pair, list, or map.
In addition to keyed/composite-key/key-range queries which are supported by LevelDB, CouchDB also supports full data rich queries capability, such as non-key queries against the whole blockchain data,
since its data content is stored in JSON format and fully queryable. Therefore, CouchDB can meet chaincode, auditing, reporting requirements for many use cases that not supported by LevelDB.</p>
<p>CouchDB can also enhance the security for compliance and data protection in the blockchain. As it is able to implement field-level security through the filtering and masking of individual attributes within a transaction, and only authorizing the read-only permission if needed.</p>
<p>In addition, CouchDB falls into the AP-type (Availability and Partition Tolerance) of the CAP theorem. It uses a master-master replication model with <code class="docutils literal notranslate"><span class="pre">Eventual</span> <span class="pre">Consistency</span></code>.
More information can be found on the
<a class="reference external" href="http://docs.couchdb.org/en/latest/intro/consistency.html">Eventual Consistency page of the CouchDB documentation</a>.
However, under each fabric peer, there is no database replicas, writes to database are guaranteed consistent and durable (not <code class="docutils literal notranslate"><span class="pre">Eventual</span> <span class="pre">Consistency</span></code>).</p>
<p>CouchDB is the first external pluggable state database for Fabric, and there could and should be other external database options. For example, IBM enables the relational database for its blockchain.
And the CP-type (Consistency and Partition Tolerance) databases may also in need, so as to enable data consistency without application level guarantee.</p>
</div>
<div class="section" id="a-note-on-data-persistence">
<h2>A Note on Data Persistence<a class="headerlink" href="#a-note-on-data-persistence" title="Permalink to this headline">¶</a></h2>
<p>If data persistence is desired on the peer container or the CouchDB container,
one option is to mount a directory in the docker-host into a relevant directory
in the container. For example, you may add the following two lines in
the peer container specification in the <code class="docutils literal notranslate"><span class="pre">docker-compose-base.yaml</span></code> file:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">volumes</span><span class="p">:</span>
 <span class="o">-</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">peer0</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">production</span>
</pre></div>
</div>
<p>For the CouchDB container, you may add the following two lines in the CouchDB
container specification:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">volumes</span><span class="p">:</span>
 <span class="o">-</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">couchdb0</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">couchdb</span><span class="o">/</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<span id="troubleshoot"></span><h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Always start your network fresh.  Use the following command
to remove artifacts, crypto, containers and chaincode images:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">m</span> <span class="n">down</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You <strong>will</strong> see errors if you do not remove old containers
and images.</p>
</div>
</li>
<li><p class="first">If you see Docker errors, first check your docker version (<a class="reference internal" href="prereqs.html"><span class="doc">Prerequisites</span></a>),
and then try restarting your Docker process.  Problems with Docker are
oftentimes not immediately recognizable.  For example, you may see errors
resulting from an inability to access crypto material mounted within a
container.</p>
<p>If they persist remove your images and start from scratch:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>docker rm -f $(docker ps -aq)
docker rmi -f $(docker images -q)
</pre></div>
</div>
</li>
<li><p class="first">If you see errors on your create, instantiate, invoke or query commands, make
sure you have properly updated the channel name and chaincode name.  There
are placeholder values in the supplied sample commands.</p>
</li>
<li><p class="first">If you see the below error:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">Error</span> <span class="n">endorsing</span> <span class="n">chaincode</span><span class="p">:</span> <span class="n">rpc</span> <span class="n">error</span><span class="p">:</span> <span class="n">code</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">Error</span> <span class="n">installing</span> <span class="n">chaincode</span> <span class="n">code</span> <span class="n">mycc</span><span class="p">:</span><span class="mf">1.0</span><span class="p">(</span><span class="n">chaincode</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">production</span><span class="o">/</span><span class="n">chaincodes</span><span class="o">/</span><span class="n">mycc</span><span class="o">.</span><span class="mf">1.0</span> <span class="n">exits</span><span class="p">)</span>
</pre></div>
</div>
<p>You likely have chaincode images (e.g. <code class="docutils literal notranslate"><span class="pre">dev-peer1.org2.example.com-mycc-1.0</span></code> or
<code class="docutils literal notranslate"><span class="pre">dev-peer0.org1.example.com-mycc-1.0</span></code>) from prior runs. Remove them and try
again.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>docker rmi -f $(docker images | grep peer[0-9]-peer[0-9] | awk &#39;{print $3}&#39;)
</pre></div>
</div>
</li>
<li><p class="first">If you see something similar to the following:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">connecting</span><span class="p">:</span> <span class="n">rpc</span> <span class="n">error</span><span class="p">:</span> <span class="n">code</span> <span class="o">=</span> <span class="mi">14</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">grpc</span><span class="p">:</span> <span class="n">RPC</span> <span class="n">failed</span> <span class="n">fast</span> <span class="n">due</span> <span class="n">to</span> <span class="n">transport</span> <span class="n">failure</span>
<span class="n">Error</span><span class="p">:</span> <span class="n">rpc</span> <span class="n">error</span><span class="p">:</span> <span class="n">code</span> <span class="o">=</span> <span class="mi">14</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">grpc</span><span class="p">:</span> <span class="n">RPC</span> <span class="n">failed</span> <span class="n">fast</span> <span class="n">due</span> <span class="n">to</span> <span class="n">transport</span> <span class="n">failure</span>
</pre></div>
</div>
<p>Make sure you are running your network against the “1.0.0” images that have
been retagged as “latest”.</p>
</li>
<li><p class="first">If you see the below error:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">configtx</span><span class="o">/</span><span class="n">tool</span><span class="o">/</span><span class="n">localconfig</span><span class="p">]</span> <span class="n">Load</span> <span class="o">-&gt;</span> <span class="n">CRIT</span> <span class="mi">002</span> <span class="n">Error</span> <span class="n">reading</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Unsupported</span> <span class="n">Config</span> <span class="n">Type</span> <span class="s2">&quot;&quot;</span>
<span class="n">panic</span><span class="p">:</span> <span class="n">Error</span> <span class="n">reading</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Unsupported</span> <span class="n">Config</span> <span class="n">Type</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Then you did not set the <code class="docutils literal notranslate"><span class="pre">FABRIC_CFG_PATH</span></code> environment variable properly.  The
configtxgen tool needs this variable in order to locate the configtx.yaml.  Go
back and execute an <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">FABRIC_CFG_PATH=$PWD</span></code>, then recreate your
channel artifacts.</p>
</li>
<li><p class="first">To cleanup the network, use the <code class="docutils literal notranslate"><span class="pre">down</span></code> option:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">byfn</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">m</span> <span class="n">down</span>
</pre></div>
</div>
</li>
<li><p class="first">If you see an error stating that you still have “active endpoints”, then prune
your Docker networks.  This will wipe your previous networks and start you with a
fresh environment:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">network</span> <span class="n">prune</span>
</pre></div>
</div>
<p>You will see the following message:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>WARNING! This will remove all networks not used by at least one container.
Are you sure you want to continue? [y/N]
</pre></div>
</div>
<p>Select <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you continue to see errors, share your logs on the
<strong>fabric-questions</strong> channel on
<a class="reference external" href="https://chat.hyperledger.org/home">Hyperledger Rocket Chat</a>
or on <a class="reference external" href="https://stackoverflow.com/questions/tagged/hyperledger-fabric">StackOverflow</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="write_first_app.html" class="btn btn-neutral float-right" title="Writing Your First Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorials.html" class="btn btn-neutral" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'master',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>
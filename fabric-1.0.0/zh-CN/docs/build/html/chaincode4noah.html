

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Chaincode for Operators &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Videos" href="videos.html" />
    <link rel="prev" title="Chaincode for Developers" href="chaincode4ade.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
<br>
<a href="https://chat.hyperledger.org">Rocket Chat</a>  <a href="https://jenkins.hyperledger.org/">CI</a>
<a href="http://stackoverflow.com/questions/tagged/hyperledger-fabric">StackOverflow</a>
<br>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prereqs.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="samples.html">Hyperledger Fabric Samples</a></li>
</ul>
<p class="caption"><span class="caption-text">Key Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="blockchain.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="capabilities.html">Hyperledger Fabric Capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="fabric_model.html">Hyperledger Fabric Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use Cases</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="build_network.html">Building Your First Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="write_first_app.html">Writing Your First Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="chaincode.html">Chaincode Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="chaincode4ade.html">Chaincode for Developers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chaincode for Operators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-chaincode">What is Chaincode?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#chaincode-lifecycle">Chaincode lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packaging">Packaging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-package">Creating the package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-signing">Package signing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-chaincode">Installing chaincode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instantiate">Instantiate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrade">Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stop-and-start">Stop and Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cli">CLI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#system-chaincode">System chaincode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="videos.html">Videos</a></li>
</ul>
<p class="caption"><span class="caption-text">Operations Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="msp.html">Membership Service Providers (MSP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="configtx.html">Channel Configuration (configtx)</a></li>
<li class="toctree-l1"><a class="reference internal" href="configtxgen.html">Channel Configuration (configtxgen)</a></li>
<li class="toctree-l1"><a class="reference internal" href="configtxlator.html">Reconfiguring with configtxlator</a></li>
<li class="toctree-l1"><a class="reference internal" href="endorsement-policies.html">Endorsement policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="error-handling.html">Error handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging-control.html">Logging Control</a></li>
</ul>
<p class="caption"><span class="caption-text">Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="arch-deep-dive.html">Architecture Explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="txflow.html">Transaction Flow</a></li>
<li class="toctree-l1"><a class="reference external" href="http://hyperledger-fabric-ca.readthedocs.io/en/latest">Hyperledger Fabric CA's User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="fabric-sdks.html">Hyperledger Fabric SDKs</a></li>
<li class="toctree-l1"><a class="reference internal" href="kafka.html">Bringing up a Kafka-based Ordering Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="channels.html">Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="ledger.html">Ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="readwrite.html">Read-Write set semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="gossip.html">Gossip data dissemination protocol</a></li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting and FAQs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Fabric-FAQ.html">Hyperledger Fabric FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="MAINTAINERS.html">Maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="jira_navigation.html">Using Jira to understand current work items</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/devenv.html">Setting up the development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/build.html">Building Hyperledger Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/build.html#building-outside-of-vagrant">Building outside of Vagrant</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/build.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/build.html#logging">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/lf-account.html">Requesting a Linux Foundation Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/gerrit.html">Working with Gerrit</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/changes.html">Submitting a Change to Gerrit</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/reviewing.html">Reviewing a Change</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/best-practices.html">Gerrit Recommended Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Style-guides/go-style.html">Coding guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="Style-guides/go-style.html#generating-grpc-code">Generating gRPC code</a></li>
<li class="toctree-l1"><a class="reference internal" href="Style-guides/go-style.html#adding-or-updating-go-packages">Adding or updating Go packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Chaincode for Operators</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/chaincode4noah.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chaincode-for-operators">
<h1>Chaincode for Operators<a class="headerlink" href="#chaincode-for-operators" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-chaincode">
<h2>What is Chaincode?<a class="headerlink" href="#what-is-chaincode" title="Permalink to this headline">¶</a></h2>
<p>Chaincode is a program, written in <a class="reference external" href="https://golang.org">Go</a>, and eventually
in other programming languages such as Java, that implements a
prescribed interface. Chaincode runs in a secured Docker container isolated from
the endorsing peer process. Chaincode initializes and manages ledger state
through transactions submitted by applications.</p>
<p>A chaincode typically handles business logic agreed to by members of the
network, so it may be considered as a “smart contract”. State created by a
chaincode is scoped exclusively to that chaincode and can’t be accessed
directly by another chaincode. However, within the same network, given
the appropriate permission a chaincode may invoke another chaincode to
access its state.</p>
<p>In the following sections, we will explore chaincode through the eyes of a
blockchain network operator, Noah. For Noah’s interests, we will focus
on chaincode lifecycle operations; the process of packaging, installing,
instantiating and upgrading the chaincode as a function of the chaincode’s
operational lifecycle within a blockchain network.</p>
</div>
<div class="section" id="chaincode-lifecycle">
<h2>Chaincode lifecycle<a class="headerlink" href="#chaincode-lifecycle" title="Permalink to this headline">¶</a></h2>
<p>The Hyperledger Fabric API enables interaction with the various nodes
in a blockchain network - the peers, orderers and MSPs - and it also allows
one to package, install, instantiate and upgrade chaincode on the endorsing
peer nodes. The Hyperledger Fabric language-specific SDKs
abstract the specifics of the Hyperledger Fabric API to facilitate
application development, though it can be used to manage a chaincode’s
lifecycle. Additionally, the Hyperledger Fabric API can be accessed
directly via the CLI, which we will use in this document.</p>
<p>We provide four commands to manage a chaincode’s lifecycle: <code class="docutils literal notranslate"><span class="pre">package</span></code>,
<code class="docutils literal notranslate"><span class="pre">install</span></code>, <code class="docutils literal notranslate"><span class="pre">instantiate</span></code>, and <code class="docutils literal notranslate"><span class="pre">upgrade</span></code>. In a future release, we are
considering adding <code class="docutils literal notranslate"><span class="pre">stop</span></code> and <code class="docutils literal notranslate"><span class="pre">start</span></code> transactions to disable and re-enable
a chaincode without having to actually uninstall it. After a chaincode has
been successfully installed and instantiated, the chaincode is active (running)
and can process transactions via the <code class="docutils literal notranslate"><span class="pre">invoke</span></code> transaction. A chaincode may be
upgraded any time after it has been installed.</p>
</div>
<div class="section" id="packaging">
<span id="package"></span><h2>Packaging<a class="headerlink" href="#packaging" title="Permalink to this headline">¶</a></h2>
<p>The chaincode package consists of 3 parts:</p>
<blockquote>
<div><ul class="simple">
<li>the chaincode, as defined by <code class="docutils literal notranslate"><span class="pre">ChaincodeDeploymentSpec</span></code> or CDS. The CDS
defines the chaincode package in terms of the code and other properties
such as name and version,</li>
<li>an optional instantiation policy which can be syntactically described
by the same policy used for endorsement and described in
<a class="reference internal" href="endorsement-policies.html"><span class="doc">Endorsement policies</span></a>, and</li>
<li>a set of signatures by the entities that “own” the chaincode.</li>
</ul>
</div></blockquote>
<p>The signatures serve the following purposes:</p>
<blockquote>
<div><ul class="simple">
<li>to establish an ownership of the chaincode,</li>
<li>to allow verification of the contents of the package, and</li>
<li>to allow detection of package tampering.</li>
</ul>
</div></blockquote>
<p>The creator of the instantiation transaction of the chaincode on a channel is
validated against the instantiation policy of the chaincode.</p>
<div class="section" id="creating-the-package">
<h3>Creating the package<a class="headerlink" href="#creating-the-package" title="Permalink to this headline">¶</a></h3>
<p>There are two approaches to packaging chaincode. One for when you want to have
multiple owners of a chaincode, and hence need to have the chaincode package
signed by multiple identities. This workflow requires that we initially create a
signed chaincode package (a <code class="docutils literal notranslate"><span class="pre">SignedCDS</span></code>) which is subsequently passed serially
to each of the other owners for signing.</p>
<p>The simpler workflow is for when you are deploying a SignedCDS that has only the
signature of the identity of the node that is issuing the <code class="docutils literal notranslate"><span class="pre">install</span></code>
transaction.</p>
<p>We will address the more complex case first. However, you may skip ahead to the
<a class="reference internal" href="#install"><span class="std std-ref">Installing chaincode</span></a> section below if you do not need to worry about multiple owners
just yet.</p>
<p>To create a signed chaincode package, use the following command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peer</span> <span class="n">chaincode</span> <span class="n">package</span> <span class="o">-</span><span class="n">n</span> <span class="n">mycc</span> <span class="o">-</span><span class="n">p</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">chaincode</span><span class="o">/</span><span class="n">go</span><span class="o">/</span><span class="n">chaincode_example02</span> <span class="o">-</span><span class="n">v</span> <span class="mi">0</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">S</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;AND(&#39;OrgA.admin&#39;)&quot;</span> <span class="n">ccpack</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-s</span></code> option creates a package that can be signed by multiple owners as
opposed to simply creating a raw CDS. When <code class="docutils literal notranslate"><span class="pre">-s</span></code> is specified, the <code class="docutils literal notranslate"><span class="pre">-S</span></code>
option must also be specified if other owners are going to need to sign.
Otherwise, the process will create a SignedCDS that includes only the
instantiation policy in addition to the CDS.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-S</span></code> option directs the process to sign the package
using the MSP identified by the value of the <code class="docutils literal notranslate"><span class="pre">localMspid</span></code> property in
<code class="docutils literal notranslate"><span class="pre">core.yaml</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-S</span></code> option is optional. However if a package is created without a
signature, it cannot be signed by any other owner using the
<code class="docutils literal notranslate"><span class="pre">signpackage</span></code> command.</p>
<p>The optional <code class="docutils literal notranslate"><span class="pre">-i</span></code> option allows one to specify an instantiation policy
for the chaincode. The instantiation policy has the same format as an
endorsement policy and specifies which identities can instantiate the
chaincode. In the example above, only the admin of OrgA is allowed to
instantiate the chaincode. If no policy is provided, the default policy
is used, which only allows the admin identity of the peer’s MSP to
instantiate chaincode.</p>
</div>
<div class="section" id="package-signing">
<h3>Package signing<a class="headerlink" href="#package-signing" title="Permalink to this headline">¶</a></h3>
<p>A chaincode package that was signed at creation can be handed over to other
owners for inspection and signing. The workflow supports out-of-band signing
of chaincode package.</p>
<p>The
<a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/protos/peer/chaincode.proto#L78">ChaincodeDeploymentSpec</a>
may be optionally be signed by the collective owners to create a
<a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/protos/peer/signed_cc_dep_spec.proto#L26">SignedChaincodeDeploymentSpec</a>
(or SignedCDS). The SignedCDS contains 3 elements:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The CDS contains the source code, the name, and version of the chaincode.</li>
<li>An instantiation policy of the chaincode, expressed as endorsement policies.</li>
<li>The list of chaincode owners, defined by means of
<a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/protos/peer/proposal_response.proto#L111">Endorsement</a>.</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that this endorsement policy is determined out-of-band to
provide proper MSP principals when the chaincode is instantiated
on some channels. If the instantiation policy is not specified,
the default policy is any MSP administrator of the channel.</p>
</div>
<p>Each owner endorses the ChaincodeDeploymentSpec by combining it
with that owner’s identity (e.g. certificate) and signing the combined
result.</p>
<p>A chaincode owner can sign a previously created signed package using the
following command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peer</span> <span class="n">chaincode</span> <span class="n">signpackage</span> <span class="n">ccpack</span><span class="o">.</span><span class="n">out</span> <span class="n">signedccpack</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">ccpack.out</span></code> and <code class="docutils literal notranslate"><span class="pre">signedccpack.out</span></code> are the input and output
packages, respectively. <code class="docutils literal notranslate"><span class="pre">signedccpack.out</span></code> contains an additional
signature over the package signed using the Local MSP.</p>
</div>
<div class="section" id="installing-chaincode">
<span id="install"></span><h3>Installing chaincode<a class="headerlink" href="#installing-chaincode" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">install</span></code> transaction packages a chaincode’s source code into a prescribed
format called a <code class="docutils literal notranslate"><span class="pre">ChaincodeDeploymentSpec</span></code> (or CDS) and installs it on a
peer node that will run that chaincode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must install the chaincode on <strong>each</strong> endorsing peer node
of a channel that will run your chaincode.</p>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">install</span></code> API is given simply a <code class="docutils literal notranslate"><span class="pre">ChaincodeDeploymentSpec</span></code>,
it will default the instantiation policy and include an empty owner list.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Chaincode should only be installed on endorsing peer nodes of the
owning members of the chaincode to protect the confidentiality of
the chaincode logic from other members on the network. Those members
without the chaincode, can’t be the endorsers of the chaincode’s
transactions; that is, they can’t execute the chaincode. However,
they can still validate and commit the transactions to the ledger.</p>
</div>
<p>To install a chaincode, send a <a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/protos/peer/proposal.proto#L104">SignedProposal</a>
to the <code class="docutils literal notranslate"><span class="pre">lifecycle</span> <span class="pre">system</span> <span class="pre">chaincode</span></code> (LSCC) described in the <a class="reference internal" href="#system-chaincode">System Chaincode</a>
section. For example, to install the <strong>sacc</strong> sample chaincode described
in section <a class="reference internal" href="chaincode4ade.html#simple-asset-chaincode"><span class="std std-ref">Simple Asset Chaincode</span></a>
using the CLI, the command would look like the following:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peer</span> <span class="n">chaincode</span> <span class="n">install</span> <span class="o">-</span><span class="n">n</span> <span class="n">asset_mgmt</span> <span class="o">-</span><span class="n">v</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">p</span> <span class="n">sacc</span>
</pre></div>
</div>
<p>The CLI internally creates the SignedChaincodeDeploymentSpec for <strong>sacc</strong> and
sends it to the local peer, which calls the <code class="docutils literal notranslate"><span class="pre">Install</span></code> method on the LSCC. The
argument to the <code class="docutils literal notranslate"><span class="pre">-p</span></code> option specifies the path to the chaincode, which must be
located within the source tree of the user’s <code class="docutils literal notranslate"><span class="pre">GOPATH</span></code>, e.g.
<code class="docutils literal notranslate"><span class="pre">$GOPATH/src/sacc</span></code>. See the <a class="reference internal" href="#cli">CLI</a> section for a complete description of
the command options.</p>
<p>Note that in order to install on a peer, the signature of the SignedProposal
must be from 1 of the peer’s local MSP administrators.</p>
</div>
<div class="section" id="instantiate">
<span id="id1"></span><h3>Instantiate<a class="headerlink" href="#instantiate" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">instantiate</span></code> transaction invokes the <code class="docutils literal notranslate"><span class="pre">lifecycle</span> <span class="pre">System</span> <span class="pre">Chaincode</span></code>
(LSCC) to create and initialize a chaincode on a channel. This is a
chaincode-channel binding process: a chaincode may be bound to any number of
channels and operate on each channel individually and independently. In other
words, regardless of how many other channels on which a chaincode might be
installed and instantiated, state is kept isolated to the channel to which
a transaction is submitted.</p>
<p>The creator of an <code class="docutils literal notranslate"><span class="pre">instantiate</span></code> transaction must satisfy the instantiation
policy of the chaincode included in SignedCDS and must also be a writer on the
channel, which is configured as part of the channel creation. This is important
for the security of the channel to prevent rogue entities from deploying
chaincodes or tricking members to execute chaincodes on an unbound channel.</p>
<p>For example, recall that the default instantiation policy is any channel MSP
administrator, so the creator of a chaincode instantiate transaction must be a
member of the channel administrators. When the transaction proposal arrives at
the endorser, it verifies the creator’s signature against the instantiation
policy. This is done again during the transaction validation before committing
it to the ledger.</p>
<p>The instantiate transaction also sets up the endorsement policy for that
chaincode on the channel. The endorsement policy describes the attestation
requirements for the transaction result to be accepted by members of the
channel.</p>
<p>For example, using the CLI to instantiate the <strong>sacc</strong> chaincode and initialize
the state with <code class="docutils literal notranslate"><span class="pre">john</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span></code>, the command would look like the following:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peer</span> <span class="n">chaincode</span> <span class="n">instantiate</span> <span class="o">-</span><span class="n">n</span> <span class="n">sacc</span> <span class="o">-</span><span class="n">v</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;{&quot;Args&quot;:[&quot;john&quot;,&quot;0&quot;]}&#39;</span> <span class="o">-</span><span class="n">P</span> <span class="s2">&quot;OR (&#39;Org1.member&#39;,&#39;Org2.member&#39;)&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note the endorsement policy (CLI uses polish notation), which requires an
endorsement from either member of Org1 or Org2 for all transactions to
<strong>sacc</strong>. That is, either Org1 or Org2 must sign the
result of executing the <cite>Invoke</cite> on <strong>sacc</strong> for the transactions to
be valid.</p>
</div>
<p>After being successfully instantiated, the chaincode enters the active state on
the channel and is ready to process any transaction proposals of type
<a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/protos/common/common.proto#L42">ENDORSER_TRANSACTION</a>.
The transactions are processed concurrently as they arrive at the endorsing
peer.</p>
</div>
<div class="section" id="upgrade">
<span id="id2"></span><h3>Upgrade<a class="headerlink" href="#upgrade" title="Permalink to this headline">¶</a></h3>
<p>A chaincode may be upgraded any time by changing its version, which is
part of the SignedCDS. Other parts, such as owners and instantiation policy
are optional. However, the chaincode name must be the same; otherwise it
would be considered as a totally different chaincode.</p>
<p>Prior to upgrade, the new version of the chaincode must be installed on
the required endorsers. Upgrade is a transaction similar to the instantiate
transaction, which binds the new version of the chaincode to the channel. Other
channels bound to the old version of the chaincode still run with the old
version. In other words, the <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> transaction only affects one channel
at a time, the channel to which the transaction is submitted.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that since multiple versions of a chaincode may be active
simultaneously, the upgrade process doesn’t automatically remove the
old versions, so user must manage this for the time being.</p>
</div>
<p>There’s one subtle difference with the <code class="docutils literal notranslate"><span class="pre">instantiate</span></code> transaction: the
<code class="docutils literal notranslate"><span class="pre">upgrade</span></code> transaction is checked against the current chaincode instantiation
policy, not the new policy (if specified). This is to ensure that only existing
members specified in the current instantiation policy may upgrade the chaincode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that during upgrade, the chaincode <code class="docutils literal notranslate"><span class="pre">Init</span></code> function is called to
perform any data related updates or re-initialize it, so care must be
taken to avoid resetting states when upgrading chaincode.</p>
</div>
</div>
<div class="section" id="stop-and-start">
<span id="id3"></span><h3>Stop and Start<a class="headerlink" href="#stop-and-start" title="Permalink to this headline">¶</a></h3>
<p>Note that <code class="docutils literal notranslate"><span class="pre">stop</span></code> and <code class="docutils literal notranslate"><span class="pre">start</span></code> lifecycle transactions have not yet been
implemented. However, you may stop a chaincode manually by removing the
chaincode container and the SignedCDS package from each of the endorsers. This
is done by deleting the chaincode’s container on each of the hosts or virtual
machines on which the endorsing peer nodes are running, and then deleting
the SignedCDS from each of the endorsing peer nodes:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">TODO - in order to delete the CDS from the peer node, you would need
to enter the peer node’s container, first. We really need to provide
a utility script that can do this.</p>
</div>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">container</span> <span class="nb">id</span><span class="o">&gt;</span>
<span class="n">rm</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">production</span><span class="o">/</span><span class="n">chaincodes</span><span class="o">/&lt;</span><span class="n">ccname</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">ccversion</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Stop would be useful in the workflow for doing upgrade in controlled manner,
where a chaincode can be stopped on a channel on all peers before issuing an
upgrade.</p>
</div>
<div class="section" id="cli">
<span id="id4"></span><h3>CLI<a class="headerlink" href="#cli" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We are assessing the need to distribute platform-specific binaries
for the Hyperledger Fabric <code class="docutils literal notranslate"><span class="pre">peer</span></code> binary. For the time being, you
can simply invoke the commands from within a running docker container.</p>
</div>
<p>To view the currently available CLI commands, execute the following command from
within a running <code class="docutils literal notranslate"><span class="pre">fabric-peer</span></code> Docker container:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">-</span><span class="n">peer</span> <span class="n">bash</span>
<span class="c1"># peer chaincode --help</span>
</pre></div>
</div>
<p>Which shows output similar to the example below:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span>
  <span class="n">peer</span> <span class="n">chaincode</span> <span class="p">[</span><span class="n">command</span><span class="p">]</span>

<span class="n">Available</span> <span class="n">Commands</span><span class="p">:</span>
  <span class="n">install</span>     <span class="n">Package</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">chaincode</span> <span class="n">into</span> <span class="n">a</span> <span class="n">deployment</span> <span class="n">spec</span> <span class="ow">and</span> <span class="n">save</span> <span class="n">it</span> <span class="n">on</span> <span class="n">the</span> <span class="n">peer</span><span class="s1">&#39;s path.</span>
  <span class="n">instantiate</span> <span class="n">Deploy</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">chaincode</span> <span class="n">to</span> <span class="n">the</span> <span class="n">network</span><span class="o">.</span>
  <span class="n">invoke</span>      <span class="n">Invoke</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">chaincode</span><span class="o">.</span>
  <span class="n">package</span>     <span class="n">Package</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">chaincode</span> <span class="n">into</span> <span class="n">a</span> <span class="n">deployment</span> <span class="n">spec</span><span class="o">.</span>
  <span class="n">query</span>       <span class="n">Query</span> <span class="n">using</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">chaincode</span><span class="o">.</span>
  <span class="n">signpackage</span> <span class="n">Sign</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">chaincode</span> <span class="n">package</span>
  <span class="n">upgrade</span>     <span class="n">Upgrade</span> <span class="n">chaincode</span><span class="o">.</span>

<span class="n">Flags</span><span class="p">:</span>
      <span class="o">--</span><span class="n">cafile</span> <span class="n">string</span>     <span class="n">Path</span> <span class="n">to</span> <span class="n">file</span> <span class="n">containing</span> <span class="n">PEM</span><span class="o">-</span><span class="n">encoded</span> <span class="n">trusted</span> <span class="n">certificate</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">the</span> <span class="n">ordering</span> <span class="n">endpoint</span>
  <span class="o">-</span><span class="n">C</span><span class="p">,</span> <span class="o">--</span><span class="n">chainID</span> <span class="n">string</span>    <span class="n">The</span> <span class="n">chain</span> <span class="n">on</span> <span class="n">which</span> <span class="n">this</span> <span class="n">command</span> <span class="n">should</span> <span class="n">be</span> <span class="n">executed</span> <span class="p">(</span><span class="n">default</span> <span class="s2">&quot;testchainid&quot;</span><span class="p">)</span>
  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">ctor</span> <span class="n">string</span>       <span class="n">Constructor</span> <span class="n">message</span> <span class="k">for</span> <span class="n">the</span> <span class="n">chaincode</span> <span class="ow">in</span> <span class="n">JSON</span> <span class="nb">format</span> <span class="p">(</span><span class="n">default</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="o">-</span><span class="n">E</span><span class="p">,</span> <span class="o">--</span><span class="n">escc</span> <span class="n">string</span>       <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">endorsement</span> <span class="n">system</span> <span class="n">chaincode</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">this</span> <span class="n">chaincode</span>
  <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">--</span><span class="n">lang</span> <span class="n">string</span>       <span class="n">Language</span> <span class="n">the</span> <span class="n">chaincode</span> <span class="ow">is</span> <span class="n">written</span> <span class="ow">in</span> <span class="p">(</span><span class="n">default</span> <span class="s2">&quot;golang&quot;</span><span class="p">)</span>
  <span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="o">--</span><span class="n">name</span> <span class="n">string</span>       <span class="n">Name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">chaincode</span>
  <span class="o">-</span><span class="n">o</span><span class="p">,</span> <span class="o">--</span><span class="n">orderer</span> <span class="n">string</span>    <span class="n">Ordering</span> <span class="n">service</span> <span class="n">endpoint</span>
  <span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="o">--</span><span class="n">path</span> <span class="n">string</span>       <span class="n">Path</span> <span class="n">to</span> <span class="n">chaincode</span>
  <span class="o">-</span><span class="n">P</span><span class="p">,</span> <span class="o">--</span><span class="n">policy</span> <span class="n">string</span>     <span class="n">The</span> <span class="n">endorsement</span> <span class="n">policy</span> <span class="n">associated</span> <span class="n">to</span> <span class="n">this</span> <span class="n">chaincode</span>
  <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">tid</span> <span class="n">string</span>        <span class="n">Name</span> <span class="n">of</span> <span class="n">a</span> <span class="n">custom</span> <span class="n">ID</span> <span class="n">generation</span> <span class="n">algorithm</span> <span class="p">(</span><span class="n">hashing</span> <span class="ow">and</span> <span class="n">decoding</span><span class="p">)</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">sha256base64</span>
      <span class="o">--</span><span class="n">tls</span>               <span class="n">Use</span> <span class="n">TLS</span> <span class="n">when</span> <span class="n">communicating</span> <span class="k">with</span> <span class="n">the</span> <span class="n">orderer</span> <span class="n">endpoint</span>
  <span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">username</span> <span class="n">string</span>   <span class="n">Username</span> <span class="k">for</span> <span class="n">chaincode</span> <span class="n">operations</span> <span class="n">when</span> <span class="n">security</span> <span class="ow">is</span> <span class="n">enabled</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span> <span class="n">string</span>    <span class="n">Version</span> <span class="n">of</span> <span class="n">the</span> <span class="n">chaincode</span> <span class="n">specified</span> <span class="ow">in</span> <span class="n">install</span><span class="o">/</span><span class="n">instantiate</span><span class="o">/</span><span class="n">upgrade</span> <span class="n">commands</span>
  <span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">vscc</span> <span class="n">string</span>       <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">verification</span> <span class="n">system</span> <span class="n">chaincode</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">this</span> <span class="n">chaincode</span>

<span class="n">Global</span> <span class="n">Flags</span><span class="p">:</span>
      <span class="o">--</span><span class="n">logging</span><span class="o">-</span><span class="n">level</span> <span class="n">string</span>       <span class="n">Default</span> <span class="n">logging</span> <span class="n">level</span> <span class="ow">and</span> <span class="n">overrides</span><span class="p">,</span> <span class="n">see</span> <span class="n">core</span><span class="o">.</span><span class="n">yaml</span> <span class="k">for</span> <span class="n">full</span> <span class="n">syntax</span>
      <span class="o">--</span><span class="n">test</span><span class="o">.</span><span class="n">coverprofile</span> <span class="n">string</span>   <span class="n">Done</span> <span class="p">(</span><span class="n">default</span> <span class="s2">&quot;coverage.cov&quot;</span><span class="p">)</span>

<span class="n">Use</span> <span class="s2">&quot;peer chaincode [command] --help&quot;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">a</span> <span class="n">command</span><span class="o">.</span>
</pre></div>
</div>
<p>To facilitate its use in scripted applications, the <code class="docutils literal notranslate"><span class="pre">peer</span></code> command always
produces a non-zero return code in the event of command failure.</p>
<p>Example of chaincode commands:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>peer chaincode install -n mycc -v 0 -p path/to/my/chaincode/v0
peer chaincode instantiate -n mycc -v 0 -c &#39;{&quot;Args&quot;:[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]} -C mychannel
peer chaincode install -n mycc -v 1 -p path/to/my/chaincode/v1
peer chaincode upgrade -n mycc -v 1 -c &#39;{&quot;Args&quot;:[&quot;d&quot;, &quot;e&quot;, &quot;f&quot;]} -C mychannel
peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;e&quot;]}&#39;
peer chaincode invoke -o orderer.example.com:7050  --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]}&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="system-chaincode">
<span id="id5"></span><h2>System chaincode<a class="headerlink" href="#system-chaincode" title="Permalink to this headline">¶</a></h2>
<p>System chaincode has the same programming model except that it runs within the
peer process rather than in an isolated container like normal chaincode.
Therefore, system chaincode is built into the peer executable and doesn’t follow
the same lifecycle described above. In particular, <strong>install</strong>, <strong>instantiate</strong>
and <strong>upgrade</strong> do not apply to system chaincodes.</p>
<p>The purpose of system chaincode is to shortcut gRPC communication cost between
peer and chaincode, and tradeoff the flexibility in management. For example, a
system chaincode can only be upgraded with the peer binary. It must also
register with a <a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/core/scc/importsysccs.go">fixed set of parameters</a>
compiled in and doesn’t have endorsement policies or endorsement policy
functionality.</p>
<p>System chaincode is used in Hyperledger Fabric to implement a number of
system behaviors so that they can be replaced or modified as appropriate
by a system integrator.</p>
<p>The current list of system chaincodes:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://github.com/hyperledger/fabric/tree/master/core/scc/lscc">LSCC</a>
Lifecycle system chaincode handles lifecycle requests described above.</li>
<li><a class="reference external" href="https://github.com/hyperledger/fabric/tree/master/core/scc/cscc">CSCC</a>
Configuration system chaincode handles channel configuration on the peer side.</li>
<li><a class="reference external" href="https://github.com/hyperledger/fabric/tree/master/core/scc/qscc">QSCC</a>
Query system chaincode provides ledger query APIs such as getting blocks and
transactions.</li>
<li><a class="reference external" href="https://github.com/hyperledger/fabric/tree/master/core/scc/escc">ESCC</a>
Endorsement system chaincode handles endorsement by signing the transaction
proposal response.</li>
<li><a class="reference external" href="https://github.com/hyperledger/fabric/tree/master/core/scc/vscc">VSCC</a>
Validation system chaincode handles the transaction validation, including
checking endorsement policy and multiversioning concurrency control.</li>
</ol>
<p>Care must be taken when modifying or replacing these system chaincodes,
especially LSCC, ESCC and VSCC since they are in the main transaction execution
path. It is worth noting that as VSCC validates a block before committing it to
the ledger, it is important that all peers in the channel compute the same
validation to avoid ledger divergence (non-determinism). So special care is
needed if VSCC is modified or replaced.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="videos.html" class="btn btn-neutral float-right" title="Videos" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chaincode4ade.html" class="btn btn-neutral" title="Chaincode for Developers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'master',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>